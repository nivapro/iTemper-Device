<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>iTemper device</title>
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
</script>
<![endif]-->
<style>
body {
  font-family: Verdana,sans-serif;
  font-size: 0.9em;
  color: gray
}

header, footer {
  padding: 10px;
  color: mintcream;
  background-color: navy;
}

section {
  margin: 5px;
  padding: 10px;
  background-color: lightsteelblue;
  color: black
}

article {
    margin: 5px;
    padding: 10px;
    background-color: lightyellow;
    color: darkslategray
}

nav ul {
  padding: 0;
}
li button { color: gray}
nav ul li {
  display: inline;
  margin: 5px;
}
</style>
</head>
<body>

<header>
  <h1>iTemper device</h1>
</header>

<nav>
  <ul>
    <li>Home</li>
    <li><button type="button" onclick='message()'>Sensors</button></li>
    <li>Locations</li>
  </ul>
</nav>

<section id="sensors">
  <h2>Sensors</h2>
</section>

<footer>
  <p>&copy; 2019 Vading management ab. All rights reserved.</p>
</footer>

<script>
var flag = false;
var sensors = [{descr:{SN:"Temper 8", port: 0}}, {descr:{SN:"Temper 8", port: 1}}, {descr:{SN:"Temper Gold", port: 0}}];
var sensorData = [{descr:{SN:"Temper 8", port: 0}, samples:[{value: 25.5, date:Date.now()}]}, {descr:{SN:"Temper 8", port: 1}, samples:[{value: 18.2, date:Date.now()+5056}]}, {descr:{SN:"Temper Gold", port: 0}, samples:[{value: 25.5, date:Date.now() + 4088}]}];
var timer;
    
function message() {
    if (!flag) {
        flag = true;
        for (sensor = 0; sensor < sensors.length; sensor++) {
            article = document.createElement("article")
            sensorName = sensors[sensor].descr.SN + ", port: " + sensors[sensor].descr.port;
            title = document.createElement("h2")
            title.innerHTML = sensorName;
            article.appendChild(title);
            noSensorData = document.createElement("div");
            noSensorData.innerHTML = "No sensor data";
            noSensorData.id = "sensor-" + sensor;
            article.appendChild(noSensorData);
            section = document.getElementById("sensors");
            section.appendChild(article);
        }
    }
    else {
        for (sensor = 0; sensor < sensorData.length; sensor++) {
            article = document.createElement("article")
            sensorName = sensors[sensor].descr.SN + ", port: " + sensors[sensor].descr.port;
            title = document.createElement("h2")
            title.innerHTML = sensorName;
            article.appendChild(title);
            sensorValue = document.getElementById("sensor-" + sensor);
            date = new Date(Date.now() - Math.floor(Math.random() * 15000));
            value = sensorData[sensor].samples[0].value + 5 * Math.random();
            sensorData[sensor].samples[0].value = value;
            sensorData[sensor].samples[0].date = date;
            value = round(value, 0.001);
            sensorValue.innerHTML = value + " Â°C, from: " + date.toLocaleDateString() + ", " + date.toLocaleTimeString();
        }
        clearTimeout(timer);  
        timer = setInterval(clearSensorValue, 5000);

    }
}

function clearSensorValue() {
    for (sensor = 0; sensor < sensorData.length; sensor++) {
        sampleDate = sensorData[sensor].samples[0].date;
        if (Date.now() - sampleDate > 30000) {
            sensorValue = document.getElementById("sensor-" + sensor);
            sensorValue.innerHTML = "No sensor data received last 30 seconds";
        }
    }
}
    
function round(value, precision) {
    precision || (precision = 1);
    var inverse = 1.0 / precision;
    return Math.round(value * inverse) / inverse;
}

</script>
</body>