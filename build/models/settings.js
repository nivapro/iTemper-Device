"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = require("../config");
var logger_1 = require("./../logger");
var Settings = (function () {
    function Settings() {
    }
    Settings.initializeSettings = function () {
        Settings.add(Settings.SERIAL_NUMBER, 'Serial Number', config_1.conf.SERIAL_NUMBER, '', 'Serial Number (SN)', !Settings.READONLY);
        Settings.add(Settings.AZURE_CONNECTION_STRING, 'Azure connection string', config_1.conf.AZURE_CONNECTION_STRING, '', 'Connection string to AZURE IOT HUB', !Settings.READONLY);
        Settings.add(Settings.CONSOLE_LEVEL, 'Console log level', config_1.conf.CONSOLE_LEVEL, 'info', 'Event level logged on console: error | info | debug', !Settings.READONLY);
        Settings.add(Settings.ERROR_LEVEL, 'Error file log level', config_1.conf.ERROR_LEVEL, 'error', 'Event level logged on file: error | info | debug', !Settings.READONLY);
        Settings.add(Settings.ERROR_LOG_FILE, 'Application error log file', config_1.conf.ERROR_LOG_FILE, 'itemper-error.log', 'Name of the log file. You find it in the application root directory', Settings.READONLY);
        Settings.add(Settings.HOSTNAME, 'Hostname', config_1.conf.HOSTNAME, '', 'This device \'s hostname', Settings.READONLY);
        Settings.add(Settings.ITEMPER_URL, 'iTemper URL', config_1.conf.ITEMPER_URL, 'https://itemper.io', 'The device use\'s this URL when connecting to iTemper', !Settings.READONLY);
        Settings.add(Settings.POLL_INTERVAL, 'Sensor poll interval', config_1.conf.POLL_INTERVAL, 5000, 'Interval (ms) between polling the sensors', !Settings.READONLY);
        Settings.add(Settings.WS_ORIGIN, 'WebSocket origin', config_1.conf.WS_ORIGIN, 'https://itemper.io', 'Origin used when connecting to iTemper with WebSockets', !Settings.READONLY);
        Settings.add(Settings.WS_URL, 'WebSocket URL', config_1.conf.WS_URL, 'wss://itemper.io', 'WebSocket URL to iTemper', !Settings.READONLY);
        Settings.add(Settings.SHARED_ACCESS_KEY, 'Shared access key', config_1.conf.SHARED_ACCESS_KEY, '', 'Add the Shared key to a device on an itemper.io user account ' +
            ' to allow the this device to log sensor data on itemper.io', !Settings.READONLY);
        Settings.onChange(Settings.CONSOLE_LEVEL, function (setting) {
            logger_1.setLevel(setting.value.toString());
        });
    };
    Settings.onChange = function (settingName, publish) {
        logger_1.log.info('Settings.onChange: ' + settingName);
        Settings.listeners.push({ settingName: settingName, publish: publish });
        var setting = Settings.get(settingName);
        if (setting) {
            publish(setting);
        }
    };
    Settings.publish = function (setting) {
        for (var _i = 0, _a = Settings.listeners; _i < _a.length; _i++) {
            var listener = _a[_i];
            if (listener.settingName === setting.name) {
                listener.publish(setting);
            }
        }
    };
    Settings.all = function () {
        var allSettings = [];
        Settings.forEach(function (setting) { return allSettings.push(setting); });
        return allSettings;
    };
    Settings.add = function (name, label, value, defaultValue, text, readonly) {
        var setting = Settings.create(name, label, value, defaultValue, text, readonly);
        Settings.set(setting);
        Settings.publish(setting);
    };
    Settings.create = function (name, label, value, defaultValue, text, readonly) {
        if (value) {
            return { name: name, label: label, value: value, defaultValue: defaultValue, text: text, readonly: readonly };
        }
        else {
            return { name: name, label: label, value: defaultValue, defaultValue: defaultValue, text: text, readonly: readonly };
        }
    };
    Settings.get = function (name) {
        var setting = Settings.map.get(name);
        if (setting) {
            return setting;
        }
        else {
            throw Error(name);
        }
    };
    Settings.toNum = function (setting) {
        return Number(setting.value);
    };
    Settings.prototype.toString = function (setting) {
        if (typeof setting.value === 'number') {
            return setting.value.toString();
        }
        else {
            return setting.value;
        }
    };
    Settings.has = function (name) {
        return Settings.map.has(name);
    };
    Settings.set = function (setting) {
        Settings.map.set(setting.name, setting);
        logger_1.log.info('Settings.set: ' + JSON.stringify(setting));
    };
    Settings.update = function (name, value, callback) {
        var setting = Settings.get(name);
        if (setting && !setting.readonly) {
            setting.value = value;
            logger_1.log.info('Settings.update: setting ' + name + ' has new value:' + setting.value);
            callback(true);
            this.publish(setting);
        }
        else {
            logger_1.log.error('Settings.update: Cannot update readonly setting' + name + ' to ' + value);
            callback(false);
        }
    };
    Settings.forEach = function (callbackfn) {
        Settings.map.forEach(callbackfn);
    };
    Settings.map = new Map();
    Settings.listeners = [];
    Settings.SERIAL_NUMBER = 'SERIAL_NUMBER';
    Settings.AZURE_CONNECTION_STRING = 'AZURE_CONNECTION_STRING';
    Settings.CONSOLE_LEVEL = 'CONSOLE_LEVEL';
    Settings.ERROR_LEVEL = 'ERROR_LEVEL';
    Settings.ERROR_LOG_FILE = 'ERROR_LOG_FILE';
    Settings.HOSTNAME = 'HOSTNAME';
    Settings.ITEMPER_URL = 'ITEMPER_URL';
    Settings.POLL_INTERVAL = 'POLL_INTERVAL';
    Settings.WS_ORIGIN = 'WS_ORIGIN';
    Settings.WS_URL = 'WS_URL';
    Settings.SHARED_ACCESS_KEY = 'SHARED_ACCESS_KEY';
    Settings.READONLY = true;
    return Settings;
}());
exports.Settings = Settings;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbHMvc2V0dGluZ3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxvQ0FBaUM7QUFFakMsc0NBQTRDO0FBbUI1QztJQUFBO0lBOElBLENBQUM7SUE1SGlCLDJCQUFrQixHQUFoQztRQUNJLFFBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxlQUFlLEVBQUUsYUFBSSxDQUFDLGFBQWEsRUFBRyxFQUFFLEVBQzdFLG9CQUFvQixFQUFFLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLHVCQUF1QixFQUFFLHlCQUF5QixFQUFFLGFBQUksQ0FBQyx1QkFBdUIsRUFBRyxFQUFFLEVBQ3ZHLG9DQUFvQyxFQUFFLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzlELFFBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxtQkFBbUIsRUFBRSxhQUFJLENBQUMsYUFBYSxFQUFFLE1BQU0sRUFDaEYscURBQXFELEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0UsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLHNCQUFzQixFQUFFLGFBQUksQ0FBQyxXQUFXLEVBQUUsT0FBTyxFQUNoRixrREFBa0QsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM1RSxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsNEJBQTRCLEVBQUUsYUFBSSxDQUFDLGNBQWMsRUFBRSxtQkFBbUIsRUFDeEcscUVBQXFFLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzlGLFFBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsYUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQ3pELDBCQUEwQixFQUFFLFFB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LHlCQUF5QixDQUFDO0lBQzVELHNCQUFhLEdBQUcsZUFBZSxDQUFDO0lBQ2hDLG9CQUFXLEdBQUUsYUFBYSxDQUFDO0lBQzNCLHVCQUFjLEdBQUcsZ0JBQWdCLENBQUM7SUFDbEMsaUJBQVEsR0FBRyxVQUFVLENBQUM7SUFDdEIsb0JBQVcsR0FBRyxhQUFhLENBQUM7SUFDNUIsc0JBQWEsR0FBRyxlQUFlLENBQUM7SUFDaEMsa0JBQVMsR0FBRyxXQUFXLENBQUM7SUFDeEIsZUFBTSxHQUFHLFFBQVEsQ0FBQztJQUNsQiwwQkFBaUIsR0FBRyxtQkFBbUIsQ0FBQztJQUV4QyxpQkFBUSxHQUFHLElBQUksQ0FBQztJQThIbEMsZUFBQztDQTlJRCxBQThJQyxJQUFBO0FBOUlZLDRCQUFRIiwiZmlsZSI6Im1vZGVscy9zZXR0aW5ncy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbmYgfSBmcm9tICcuLi9jb25maWcnO1xyXG5cclxuaW1wb3J0IHsgbG9nLCBzZXRMZXZlbCB9IGZyb20gJy4vLi4vbG9nZ2VyJztcclxuXHJcbmV4cG9ydCB0eXBlIFNldHRpbmdWYWx1ZSA9IHN0cmluZyB8IG51bWJlcjtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2V0dGluZyB7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBsYWJlbDogc3RyaW5nO1xyXG4gICAgdmFsdWU6IFNldHRpbmdWYWx1ZTtcclxuICAgIGRlZmF1bHRWYWx1ZTogU2V0dGluZ1ZhbHVlO1xyXG4gICAgdGV4dDogc3RyaW5nO1xyXG4gICAgcmVhZG9ubHk6IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIExpc3RlbmVyID0gKHNldHRpbmdzOiBTZXR0aW5nKSA9PiB2b2lkO1xyXG5leHBvcnQgaW50ZXJmYWNlIFNldHRpbmdMaXN0ZW5lciB7XHJcbiAgICBzZXR0aW5nTmFtZTogc3RyaW5nO1xyXG4gICAgcHVibGlzaDogTGlzdGVuZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBTZXR0aW5ncyB7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBtYXAgPSBuZXcgTWFwPHN0cmluZywgU2V0dGluZz4oKTtcclxuICAgIHByaXZhdGUgc3RhdGljIGxpc3RlbmVyczogU2V0dGluZ0xpc3RlbmVyW10gPSBbXTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIFNFUklBTF9OVU1CRVIgPSAnU0VSSUFMX05VTUJFUic7XHJcbiAgICBwdWJsaWMgc3RhdGljIEFaVVJFX0NPTk5FQ1RJT05fU1RSSU5HOiBzdHJpbmcgPSAnQVpVUkVfQ09OTkVDVElPTl9TVFJJTkcnO1xyXG4gICAgcHVibGljIHN0YXRpYyBDT05TT0xFX0xFVkVMID0gJ0NPTlNPTEVfTEVWRUwnO1xyXG4gICAgcHVibGljIHN0YXRpYyBFUlJPUl9MRVZFTD0gJ0VSUk9SX0xFVkVMJztcclxuICAgIHB1YmxpYyBzdGF0aWMgRVJST1JfTE9HX0ZJTEUgPSAnRVJST1JfTE9HX0ZJTEUnO1xyXG4gICAgcHVibGljIHN0YXRpYyBIT1NUTkFNRSA9ICdIT1NUTkFNRSc7XHJcbiAgICBwdWJsaWMgc3RhdGljIElURU1QRVJfVVJMID0gJ0lURU1QRVJfVVJMJztcclxuICAgIHB1YmxpYyBzdGF0aWMgUE9MTF9JTlRFUlZBTCA9ICdQT0xMX0lOVEVSVkFMJztcclxuICAgIHB1YmxpYyBzdGF0aWMgV1NfT1JJR0lOID0gJ1dTX09SSUdJTic7XHJcbiAgICBwdWJsaWMgc3RhdGljIFdTX1VSTCA9ICdXU19VUkwnO1xyXG4gICAgcHVibGljIHN0YXRpYyBTSEFSRURfQUNDRVNTX0tFWSA9ICdTSEFSRURfQUNDRVNTX0tFWSc7XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBSRUFET05MWSA9IHRydWU7XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBpbml0aWFsaXplU2V0dGluZ3MoKSB7XHJcbiAgICAgICAgU2V0dGluZ3MuYWRkKFNldHRpbmdzLlNFUklBTF9OVU1CRVIsICdTZXJpYWwgTnVtYmVyJywgY29uZi5TRVJJQUxfTlVNQkVSLCAgJycsXHJcbiAgICAgICAgJ1NlcmlhbCBOdW1iZXIgKFNOKScsICFTZXR0aW5ncy5SRUFET05MWSk7XHJcbiAgICAgICAgU2V0dGluZ3MuYWRkKFNldHRpbmdzLkFaVVJFX0NPTk5FQ1RJT05fU1RSSU5HLCAnQXp1cmUgY29ubmVjdGlvbiBzdHJpbmcnLCBjb25mLkFaVVJFX0NPTk5FQ1RJT05fU1RSSU5HLCAgJycsXHJcbiAgICAgICAgICAgICdDb25uZWN0aW9uIHN0cmluZyB0byBBWlVSRSBJT1QgSFVCJywgIVNldHRpbmdzLlJFQURPTkxZKTtcclxuICAgICAgICBTZXR0aW5ncy5hZGQoU2V0dGluZ3MuQ09OU09MRV9MRVZFTCwgJ0NvbnNvbGUgbG9nIGxldmVsJywgY29uZi5DT05TT0xFX0xFVkVMLCAnaW5mbycsXHJcbiAgICAgICAgICAgICdFdmVudCBsZXZlbCBsb2dnZWQgb24gY29uc29sZTogZXJyb3IgfCBpbmZvIHwgZGVidWcnLCAhU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG4gICAgICAgIFNldHRpbmdzLmFkZChTZXR0aW5ncy5FUlJPUl9MRVZFTCwgJ0Vycm9yIGZpbGUgbG9nIGxldmVsJywgY29uZi5FUlJPUl9MRVZFTCwgJ2Vycm9yJyxcclxuICAgICAgICAgICAgJ0V2ZW50IGxldmVsIGxvZ2dlZCBvbiBmaWxlOiBlcnJvciB8IGluZm8gfCBkZWJ1ZycsICFTZXR0aW5ncy5SRUFET05MWSk7XHJcbiAgICAgICAgU2V0dGluZ3MuYWRkKFNldHRpbmdzLkVSUk9SX0xPR19GSUxFLCAnQXBwbGljYXRpb24gZXJyb3IgbG9nIGZpbGUnLCBjb25mLkVSUk9SX0xPR19GSUxFLCAnaXRlbXBlci1lcnJvci5sb2cnLFxyXG4gICAgICAgICAgICAnTmFtZSBvZiB0aGUgbG9nIGZpbGUuIFlvdSBmaW5kIGl0IGluIHRoZSBhcHBsaWNhdGlvbiByb290IGRpcmVjdG9yeScsIFNldHRpbmdzLlJFQURPTkxZKTtcclxuICAgICAgICBTZXR0aW5ncy5hZGQoU2V0dGluZ3MuSE9TVE5BTUUsICdIb3N0bmFtZScsIGNvbmYuSE9TVE5BTUUsICcnLFxyXG4gICAgICAgICAgICAnVGhpcyBkZXZpY2UgXFwncyBob3N0bmFtZScsIFNldHRpbmdzLlJFQURPTkxZKTtcclxuICAgICAgICBTZXR0aW5ncy5hZGQoU2V0dGluZ3MuSVRFTVBFUl9VUkwsICdpVGVtcGVyIFVSTCcsIGNvbmYuSVRFTVBFUl9VUkwsICdodHRwczovL2l0ZW1wZXIuaW8nLFxyXG4gICAgICAgICAgICAnVGhlIGRldmljZSB1c2VcXCdzIHRoaXMgVVJMIHdoZW4gY29ubmVjdGluZyB0byBpVGVtcGVyJywgIVNldHRpbmdzLlJFQURPTkxZKTtcclxuICAgICAgICBTZXR0aW5ncy5hZGQoU2V0dGluZ3MuUE9MTF9JTlRFUlZBTCwgJ1NlbnNvciBwb2xsIGludGVydmFsJywgY29uZi5QT0xMX0lOVEVSVkFMLCA1MDAwLFxyXG4gICAgICAgICAgICAnSW50ZXJ2YWwgKG1zKSBiZXR3ZWVuIHBvbGxpbmcgdGhlIHNlbnNvcnMnLCAhU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG4gICAgICAgIFNldHRpbmdzLmFkZChTZXR0aW5ncy5XU19PUklHSU4sICdXZWJTb2NrZXQgb3JpZ2luJywgY29uZi5XU19PUklHSU4sICdodHRwczovL2l0ZW1wZXIuaW8nLFxyXG4gICAgICAgICAgICAnT3JpZ2luIHVzZWQgd2hlbiBjb25uZWN0aW5nIHRvIGlUZW1wZXIgd2l0aCBXZWJTb2NrZXRzJywgIVNldHRpbmdzLlJFQURPTkxZKTtcclxuICAgICAgICBTZXR0aW5ncy5hZGQoU2V0dGluZ3MuV1NfVVJMLCAnV2ViU29ja2V0IFVSTCcsIGNvbmYuV1NfVVJMLCAnd3NzOi8vaXRlbXBlci5pbycsXHJcbiAgICAgICAgICAgICdXZWJTb2NrZXQgVVJMIHRvIGlUZW1wZXInLCAhU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG4gICAgICAgIFNldHRpbmdzLmFkZChTZXR0aW5ncy5TSEFSRURfQUNDRVNTX0tFWSwgJ1NoYXJlZCBhY2Nlc3Mga2V5JywgY29uZi5TSEFSRURfQUNDRVNTX0tFWSwgJycsXHJcbiAgICAgICAgICAgICdBZGQgdGhlIFNoYXJlZCBrZXkgdG8gYSBkZXZpY2Ugb24gYW4gaXRlbXBlci5pbyB1c2VyIGFjY291bnQgJyArXHJcbiAgICAgICAgICAgICcgdG8gYWxsb3cgdGhlIHRoaXMgZGV2aWNlIHRvIGxvZyBzZW5zb3IgZGF0YSBvbiBpdGVtcGVyLmlvJywgIVNldHRpbmdzLlJFQURPTkxZKTtcclxuXHJcblxyXG4gICAgICAgIC8vIEhlbHBlclxyXG4gICAgICAgIFNldHRpbmdzLm9uQ2hhbmdlKFNldHRpbmdzLkNPTlNPTEVfTEVWRUwsIChzZXR0aW5nOiBTZXR0aW5nKT0+IHtcclxuICAgICAgICAgICAgc2V0TGV2ZWwoc2V0dGluZy52YWx1ZS50b1N0cmluZygpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBvbkNoYW5nZShzZXR0aW5nTmFtZTogc3RyaW5nLCBwdWJsaXNoOiBMaXN0ZW5lcikge1xyXG4gICAgICAgIGxvZy5pbmZvKCdTZXR0aW5ncy5vbkNoYW5nZTogJyArIHNldHRpbmdOYW1lKTtcclxuICAgICAgICBTZXR0aW5ncy5saXN0ZW5lcnMucHVzaCh7c2V0dGluZ05hbWUsIHB1Ymxpc2h9KTtcclxuICAgICAgICBjb25zdCBzZXR0aW5nID0gU2V0dGluZ3MuZ2V0KHNldHRpbmdOYW1lKTtcclxuICAgICAgICBpZiAoc2V0dGluZykge1xyXG4gICAgICAgICAgICBwdWJsaXNoKHNldHRpbmcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBwdWJsaXNoKHNldHRpbmc6IFNldHRpbmcpIHtcclxuICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIFNldHRpbmdzLmxpc3RlbmVycykge1xyXG4gICAgICAgICAgICBpZiAobGlzdGVuZXIuc2V0dGluZ05hbWUgPT09IHNldHRpbmcubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgbGlzdGVuZXIucHVibGlzaChzZXR0aW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgYWxsKCk6IFNldHRpbmdbXSB7XHJcbiAgICAgICAgY29uc3QgYWxsU2V0dGluZ3M6IFNldHRpbmdbXSA9IFtdO1xyXG4gICAgICAgIFNldHRpbmdzLmZvckVhY2goc2V0dGluZz0+IGFsbFNldHRpbmdzLnB1c2goc2V0dGluZykpO1xyXG4gICAgICAgIHJldHVybiBhbGxTZXR0aW5ncztcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgYWRkKCAgbmFtZTogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogU2V0dGluZ1ZhbHVlIHwgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNldHRpbmdWYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkb25seTogYm9vbGVhbikge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmcgPSBTZXR0aW5ncy5jcmVhdGUobmFtZSwgbGFiZWwsIHZhbHVlLCBkZWZhdWx0VmFsdWUsIHRleHQsIHJlYWRvbmx5KTtcclxuICAgICAgICBTZXR0aW5ncy5zZXQoc2V0dGluZyk7XHJcbiAgICAgICAgU2V0dGluZ3MucHVibGlzaChzZXR0aW5nKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlKCAgIG5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogU2V0dGluZ1ZhbHVlIHwgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTZXR0aW5nVmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkb25seTogYm9vbGVhbik6IFNldHRpbmcge1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gIHtuYW1lLCBsYWJlbCwgdmFsdWUsIGRlZmF1bHRWYWx1ZSwgdGV4dCwgcmVhZG9ubHl9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7bmFtZSwgbGFiZWwsIHZhbHVlOiBkZWZhdWx0VmFsdWUsIGRlZmF1bHRWYWx1ZSwgdGV4dCwgcmVhZG9ubHl9O1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBnZXQobmFtZTogc3RyaW5nKTogU2V0dGluZyB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9ICBTZXR0aW5ncy5tYXAuZ2V0KG5hbWUpO1xyXG4gICAgICAgIGlmIChzZXR0aW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5nO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKG5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIHRvTnVtKHNldHRpbmc6IFNldHRpbmcpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiBOdW1iZXIoc2V0dGluZy52YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRvU3RyaW5nKHNldHRpbmc6IFNldHRpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc2V0dGluZy52YWx1ZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmcudmFsdWUudG9TdHJpbmcoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZy52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgaGFzKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiBTZXR0aW5ncy5tYXAuaGFzKG5hbWUpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBzZXQoc2V0dGluZzogU2V0dGluZykge1xyXG4gICAgICAgIFNldHRpbmdzLm1hcC5zZXQoc2V0dGluZy5uYW1lLCBzZXR0aW5nKTtcclxuICAgICAgICBsb2cuaW5mbyAoJ1NldHRpbmdzLnNldDogJyArIEpTT04uc3RyaW5naWZ5KHNldHRpbmcpKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIHVwZGF0ZShuYW1lOiBzdHJpbmcsIHZhbHVlOiBTZXR0aW5nVmFsdWUsIGNhbGxiYWNrOiAodXBkYXRlZDogYm9vbGVhbikgPT4gdm9pZCkge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmcgPSBTZXR0aW5ncy5nZXQobmFtZSk7XHJcbiAgICAgICAgaWYgKHNldHRpbmcgJiYgIXNldHRpbmcucmVhZG9ubHkpIHtcclxuICAgICAgICAgICAgc2V0dGluZy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICBsb2cuaW5mbygnU2V0dGluZ3MudXBkYXRlOiBzZXR0aW5nICcgKyBuYW1lICsgJyBoYXMgbmV3IHZhbHVlOicgKyBzZXR0aW5nLnZhbHVlKTtcclxuICAgICAgICAgICAgY2FsbGJhY2sodHJ1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMucHVibGlzaChzZXR0aW5nKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ1NldHRpbmdzLnVwZGF0ZTogQ2Fubm90IHVwZGF0ZSByZWFkb25seSBzZXR0aW5nJyArIG5hbWUgKyAnIHRvICcgKyB2YWx1ZSk7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBmb3JFYWNoKGNhbGxiYWNrZm46IChzZXR0aW5nOiBTZXR0aW5nKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgU2V0dGluZ3MubWFwLmZvckVhY2goY2FsbGJhY2tmbik7XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==
