"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = require("../config");
var logger_1 = require("./../logger");
var Settings = (function () {
    function Settings() {
    }
    Settings.initialize = function () {
        Settings.add(Settings.SERIAL_NUMBER, 'Serial Number', config_1.conf.SERIAL_NUMBER, '', 'Serial Number (SN)', !Settings.READONLY);
        Settings.add(Settings.AZURE_CONNECTION_STRING, 'Azure connection string', config_1.conf.AZURE_CONNECTION_STRING, '', 'Connection string to AZURE IOT HUB', !Settings.READONLY);
        Settings.add(Settings.CONSOLE_LEVEL, 'Console log level', config_1.conf.CONSOLE_LEVEL, 'info', 'Event level logged on console: error | info | debug', !Settings.READONLY);
        Settings.add(Settings.ERROR_LEVEL, 'Error file log level', config_1.conf.ERROR_LEVEL, 'error', 'Event level logged on file: error | info | debug', !Settings.READONLY);
        Settings.add(Settings.ERROR_LOG_FILE, 'Application error log file', config_1.conf.ERROR_LOG_FILE, 'itemper-error.log', 'Name of the log file. You find it in the application root directory', Settings.READONLY);
        Settings.add(Settings.HOSTNAME, 'Hostname', config_1.conf.HOSTNAME, '', 'This device \'s hostname', Settings.READONLY);
        Settings.add(Settings.ITEMPER_URL, 'iTemper URL', config_1.conf.ITEMPER_URL, 'https://itemper.io', 'The device use\'s this URL when connecting to iTemper', !Settings.READONLY);
        Settings.add(Settings.POLL_INTERVAL, 'Sensor poll interval', config_1.conf.POLL_INTERVAL, 5000, 'Interval (ms) between polling the sensors', !Settings.READONLY);
        Settings.add(Settings.WS_ORIGIN, 'WebSocket origin', config_1.conf.WS_ORIGIN, 'https://itemper.io', 'Origin used when connecting to iTemper with WebSockets', !Settings.READONLY);
        Settings.add(Settings.WS_URL, 'WebSocket URL', config_1.conf.WS_URL, 'wss://itemper.io', 'WebSocket URL to iTemper', !Settings.READONLY);
        Settings.add(Settings.SHARED_ACCESS_KEY, 'Shared access key', config_1.conf.SHARED_ACCESS_KEY, '', 'Add the Shared key to a device on an itemper.io user account ' +
            ' to allow the this device to log sensor data on itemper.io', !Settings.READONLY);
        Settings.onChange(Settings.CONSOLE_LEVEL, function (setting) {
            logger_1.setLevel(setting.value.toString());
        });
    };
    Settings.onChange = function (settingName, publish) {
        logger_1.log.info('Settings.onChange: ' + settingName);
        Settings.listeners.push({ settingName: settingName, publish: publish });
        var setting = Settings.get(settingName);
        if (setting) {
            publish(setting);
        }
    };
    Settings.publish = function (setting) {
        for (var _i = 0, _a = Settings.listeners; _i < _a.length; _i++) {
            var listener = _a[_i];
            if (listener.settingName === setting.name) {
                listener.publish(setting);
            }
        }
    };
    Settings.all = function () {
        var allSettings = [];
        Settings.forEach(function (setting) { return allSettings.push(setting); });
        return allSettings;
    };
    Settings.add = function (name, label, value, defaultValue, text, readonly) {
        var setting = Settings.create(name, label, value, defaultValue, text, readonly);
        Settings.set(setting);
        Settings.publish(setting);
    };
    Settings.create = function (name, label, value, defaultValue, text, readonly) {
        if (value) {
            return { name: name, label: label, value: value, defaultValue: defaultValue, text: text, readonly: readonly };
        }
        else {
            return { name: name, label: label, value: defaultValue, defaultValue: defaultValue, text: text, readonly: readonly };
        }
    };
    Settings.get = function (name) {
        var setting = Settings.map.get(name);
        if (setting) {
            return setting;
        }
        else {
            throw Error(name);
        }
    };
    Settings.toNum = function (setting) {
        return Number(setting.value);
    };
    Settings.prototype.toString = function (setting) {
        if (typeof setting.value === 'number') {
            return setting.value.toString();
        }
        else {
            return setting.value;
        }
    };
    Settings.has = function (name) {
        return Settings.map.has(name);
    };
    Settings.set = function (setting) {
        Settings.map.set(setting.name, setting);
        logger_1.log.info('Settings.set: ' + JSON.stringify(setting));
    };
    Settings.update = function (name, value, callback) {
        var setting = Settings.get(name);
        if (setting && !setting.readonly) {
            setting.value = value;
            logger_1.log.info('Settings.update: setting ' + name + ' has new value:' + setting.value);
            callback(true);
            this.publish(setting);
        }
        else {
            logger_1.log.error('Settings.update: Cannot update readonly setting' + name + ' to ' + value);
            callback(false);
        }
    };
    Settings.forEach = function (callbackfn) {
        Settings.map.forEach(callbackfn);
    };
    Settings.map = new Map();
    Settings.listeners = [];
    Settings.SERIAL_NUMBER = 'SERIAL_NUMBER';
    Settings.AZURE_CONNECTION_STRING = 'AZURE_CONNECTION_STRING';
    Settings.CONSOLE_LEVEL = 'CONSOLE_LEVEL';
    Settings.ERROR_LEVEL = 'ERROR_LEVEL';
    Settings.ERROR_LOG_FILE = 'ERROR_LOG_FILE';
    Settings.HOSTNAME = 'HOSTNAME';
    Settings.ITEMPER_URL = 'ITEMPER_URL';
    Settings.POLL_INTERVAL = 'POLL_INTERVAL';
    Settings.WS_ORIGIN = 'WS_ORIGIN';
    Settings.WS_URL = 'WS_URL';
    Settings.SHARED_ACCESS_KEY = 'SHARED_ACCESS_KEY';
    Settings.READONLY = true;
    return Settings;
}());
exports.Settings = Settings;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbHMvc2V0dGluZ3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxvQ0FBaUM7QUFFakMsc0NBQTRDO0FBbUI1QztJQUFBO0lBOElBLENBQUM7SUE1SGlCLG1CQUFVLEdBQXhCO1FBQ0ksUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLGVBQWUsRUFBRSxhQUFJLENBQUMsYUFBYSxFQUFHLEVBQUUsRUFDN0Usb0JBQW9CLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDMUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsdUJBQXVCLEVBQUUseUJBQXlCLEVBQUUsYUFBSSxDQUFDLHVCQUF1QixFQUFHLEVBQUUsRUFDdkcsb0NBQW9DLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUQsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLG1CQUFtQixFQUFFLGFBQUksQ0FBQyxhQUFhLEVBQUUsTUFBTSxFQUNoRixxREFBcUQsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvRSxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsc0JBQXNCLEVBQUUsYUFBSSxDQUFDLFdBQVcsRUFBRSxPQUFPLEVBQ2hGLGtEQUFrRCxFQUFFLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzVFLFFBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSw0QkFBNEIsRUFBRSxhQUFJLENBQUMsY0FBYyxFQUFFLG1CQUFtQixFQUN4RyxxRUFBcUUsRUFBRSxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUYsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSxhQUFJLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFDekQsMEJBQTBCLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ25ELFFBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxhQUFhLEVBQUUsYUFBSSxDQUFDLFdBQVcsRUFBRSxvQkFBb0IsRUFDcEYsdURBQXVELEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDakYsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLHNCQUFzQixFQUFFLGFBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxFQUNqRiwyQ0FBMkMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNyRSxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsa0JBQWtCLEVBQUUsYUFBSSxDQUFDLFNBQVMsRUFBRSxvQkFBb0IsRUFDckYsd0RBQXdELEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEYsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLGVBQWUsRUFBRSxhQUFJLENBQUMsTUFBTSxFQUFFLGtCQUFrQixFQUMxRSwwQkFBMEIsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNwRCxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxtQkFBbUIsRUFBRSxhQUFJLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxFQUNwRiwrREFBK0Q7WUFDL0QsNERBQTRELEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFJdEYsUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLFVBQUMsT0FBZ0I7WUFDdkQsaUJBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBR2EsaUJBQVEsR0FBdEIsVUFBdUIsV0FBbUIsRUFBRSxPQUFpQjtRQUN6RCxZQUFHLENBQUMsSUFBSSxDQUFDLHFCQUFxQixHQUFHLFdBQVcsQ0FBQyxDQUFDO1FBQzlDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUMsV0FBVyxhQUFBLEVBQUUsT0FBTyxTQUFBLEVBQUMsQ0FBQyxDQUFDO1FBQ2hELElBQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDMUMsSUFBSSxPQUFPLEVBQUU7WUFDVCxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDcEI7SUFDTCxDQUFDO0lBRWMsZ0JBQU8sR0FBdEIsVUFBdUIsT0FBZ0I7UUFDbkMsS0FBdUIsVUFBa0IsRUFBbEIsS0FBQSxRQUFRLENBQUMsU0FBUyxFQUFsQixjQUFrQixFQUFsQixJQUFrQixFQUFFO1lBQXRDLElBQU0sUUFBUSxTQUFBO1lBQ2YsSUFBSSxRQUFRLENBQUMsV0FBVyxLQUFLLE9BQU8sQ0FBQyxJQUFJLEVBQUU7Z0JBQ3ZDLFFBQVEsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDN0I7U0FDSjtJQUNMLENBQUM7SUFDYSxZQUFHLEdBQWpCO1FBQ0ksSUFBTSxXQUFXLEdBQWMsRUFBRSxDQUFDO1FBQ2xDLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQSxPQUFPLElBQUcsT0FBQSxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUF6QixDQUF5QixDQUFDLENBQUM7UUFDdEQsT0FBTyxXQUFXLENBQUM7SUFDdkIsQ0FBQztJQUNhLFlBQUcsR0FBakIsVUFBb0IsSUFBWSxFQUNaLEtBQWEsRUFDYixLQUErQixFQUMvQixZQUEwQixFQUMxQixJQUFZLEVBQ1osUUFBaUI7UUFDakMsSUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ2xGLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdEIsUUFBUSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBQ2EsZUFBTSxHQUFwQixVQUF3QixJQUFZLEVBQ1osS0FBYSxFQUNiLEtBQStCLEVBQy9CLFlBQTBCLEVBQzFCLElBQVksRUFDWixRQUFpQjtRQUNyQyxJQUFJLEtBQUssRUFBRTtZQUNQLE9BQVEsRUFBQyxJQUFJLE1BQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxZQUFZLGNBQUEsRUFBRSxJQUFJLE1BQUEsRUFBRSxRQUFRLFVBQUEsRUFBQyxDQUFDO1NBQzlEO2FBQU07WUFDSCxPQUFPLEVBQUMsSUFBSSxNQUFBLEVBQUUsS0FBSyxPQUFBLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxZQUFZLGNBQUEsRUFBRSxJQUFJLE1BQUEsRUFBRSxRQUFRLFVBQUEsRUFBQyxDQUFDO1NBRTNFO0lBRUwsQ0FBQztJQUNhLFlBQUcsR0FBakIsVUFBa0IsSUFBWTtRQUMxQixJQUFNLE9BQU8sR0FBSSxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QyxJQUFJLE9BQU8sRUFBRTtZQUNULE9BQU8sT0FBTyxDQUFDO1NBQ2xCO2FBQU07WUFDSCxNQUFNLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNyQjtJQUNMLENBQUM7SUFFYSxjQUFLLEdBQW5CLFVBQW9CLE9BQWdCO1FBQ2hDLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRU0sMkJBQVEsR0FBZixVQUFnQixPQUFnQjtRQUM1QixJQUFJLE9BQU8sT0FBTyxDQUFDLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDbkMsT0FBTyxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ25DO2FBQU07WUFDSCxPQUFPLE9BQU8sQ0FBQyxLQUFLLENBQUM7U0FDeEI7SUFFTCxDQUFDO0lBRWEsWUFBRyxHQUFqQixVQUFrQixJQUFZO1FBQzFCLE9BQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUNhLFlBQUcsR0FBakIsVUFBa0IsT0FBZ0I7UUFDOUIsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN4QyxZQUFHLENBQUMsSUFBSSxDQUFFLGdCQUFnQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRWEsZUFBTSxHQUFwQixVQUFxQixJQUFZLEVBQUUsS0FBbUIsRUFBRSxRQUFvQztRQUN4RixJQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLElBQUksT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRTtZQUM5QixPQUFPLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztZQUN0QixZQUFHLENBQUMsSUFBSSxDQUFDLDJCQUEyQixHQUFHLElBQUksR0FBRyxpQkFBaUIsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakYsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN6QjthQUFNO1lBQ0gsWUFBRyxDQUFDLEtBQUssQ0FBQyxpREFBaUQsR0FBRyxJQUFJLEdBQUcsTUFBTSxHQUFHLEtBQUssQ0FBQyxDQUFDO1lBQ3JGLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNuQjtJQUNMLENBQUM7SUFFYSxnQkFBTyxHQUFyQixVQUFzQixVQUFzQztRQUN4RCxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBNUljLFlBQUcsR0FBRyxJQUFJLEdBQUcsRUFBbUIsQ0FBQztJQUNqQyxrQkFBUyxHQUFzQixFQUFFLENBQUM7SUFFbkMsc0JBQWEsR0FBRyxlQUFlLENBQUM7SUFDaEMsZ0NBQXVCLEdBQVcseUJBQXlCLENBQUM7SUFDNUQsc0JBQWEsR0FBRyxlQUFlLENBQUM7SUFDaEMsb0JBQVcsR0FBRSxhQUFhLENBQUM7SUFDM0IsdUJBQWMsR0FBRyxnQkFBZ0IsQ0FBQztJQUNsQyxpQkFBUSxHQUFHLFVBQVUsQ0FBQztJQUN0QixvQkFBVyxHQUFHLGFBQWEsQ0FBQztJQUM1QixzQkFBYSxHQUFHLGVBQWUsQ0FBQztJQUNoQyxrQkFBUyxHQUFHLFdBQVcsQ0FBQztJQUN4QixlQUFNLEdBQUcsUUFBUSxDQUFDO0lBQ2xCLDBCQUFpQixHQUFHLG1CQUFtQixDQUFDO0lBRXhDLGlCQUFRLEdBQUcsSUFBSSxDQUFDO0lBOEhsQyxlQUFDO0NBOUlELEFBOElDLElBQUE7QUE5SVksNEJBQVEiLCJmaWxlIjoibW9kZWxzL3NldHRpbmdzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29uZiB9IGZyb20gJy4uL2NvbmZpZyc7XHJcblxyXG5pbXBvcnQgeyBsb2csIHNldExldmVsIH0gZnJvbSAnLi8uLi9sb2dnZXInO1xyXG5cclxuZXhwb3J0IHR5cGUgU2V0dGluZ1ZhbHVlID0gc3RyaW5nIHwgbnVtYmVyO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTZXR0aW5nIHtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIGxhYmVsOiBzdHJpbmc7XHJcbiAgICB2YWx1ZTogU2V0dGluZ1ZhbHVlO1xyXG4gICAgZGVmYXVsdFZhbHVlOiBTZXR0aW5nVmFsdWU7XHJcbiAgICB0ZXh0OiBzdHJpbmc7XHJcbiAgICByZWFkb25seTogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgTGlzdGVuZXIgPSAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZDtcclxuZXhwb3J0IGludGVyZmFjZSBTZXR0aW5nTGlzdGVuZXIge1xyXG4gICAgc2V0dGluZ05hbWU6IHN0cmluZztcclxuICAgIHB1Ymxpc2g6IExpc3RlbmVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2V0dGluZ3Mge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgbWFwID0gbmV3IE1hcDxzdHJpbmcsIFNldHRpbmc+KCk7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBsaXN0ZW5lcnM6IFNldHRpbmdMaXN0ZW5lcltdID0gW107XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBTRVJJQUxfTlVNQkVSID0gJ1NFUklBTF9OVU1CRVInO1xyXG4gICAgcHVibGljIHN0YXRpYyBBWlVSRV9DT05ORUNUSU9OX1NUUklORzogc3RyaW5nID0gJ0FaVVJFX0NPTk5FQ1RJT05fU1RSSU5HJztcclxuICAgIHB1YmxpYyBzdGF0aWMgQ09OU09MRV9MRVZFTCA9ICdDT05TT0xFX0xFVkVMJztcclxuICAgIHB1YmxpYyBzdGF0aWMgRVJST1JfTEVWRUw9ICdFUlJPUl9MRVZFTCc7XHJcbiAgICBwdWJsaWMgc3RhdGljIEVSUk9SX0xPR19GSUxFID0gJ0VSUk9SX0xPR19GSUxFJztcclxuICAgIHB1YmxpYyBzdGF0aWMgSE9TVE5BTUUgPSAnSE9TVE5BTUUnO1xyXG4gICAgcHVibGljIHN0YXRpYyBJVEVNUEVSX1VSTCA9ICdJVEVNUEVSX1VSTCc7XHJcbiAgICBwdWJsaWMgc3RhdGljIFBPTExfSU5URVJWQUwgPSAnUE9MTF9JTlRFUlZBTCc7XHJcbiAgICBwdWJsaWMgc3RhdGljIFdTX09SSUdJTiA9ICdXU19PUklHSU4nO1xyXG4gICAgcHVibGljIHN0YXRpYyBXU19VUkwgPSAnV1NfVVJMJztcclxuICAgIHB1YmxpYyBzdGF0aWMgU0hBUkVEX0FDQ0VTU19LRVkgPSAnU0hBUkVEX0FDQ0VTU19LRVknO1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgUkVBRE9OTFkgPSB0cnVlO1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgaW5pdGlhbGl6ZSgpIHtcclxuICAgICAgICBTZXR0aW5ncy5hZGQoU2V0dGluZ3MuU0VSSUFMX05VTUJFUiwgJ1NlcmlhbCBOdW1iZXInLCBjb25mLlNFUklBTF9OVU1CRVIsICAnJyxcclxuICAgICAgICAnU2VyaWFsIE51bWJlciAoU04pJywgIVNldHRpbmdzLlJFQURPTkxZKTtcclxuICAgICAgICBTZXR0aW5ncy5hZGQoU2V0dGluZ3MuQVpVUkVfQ09OTkVDVElPTl9TVFJJTkcsICdBenVyZSBjb25uZWN0aW9uIHN0cmluZycsIGNvbmYuQVpVUkVfQ09OTkVDVElPTl9TVFJJTkcsICAnJyxcclxuICAgICAgICAgICAgJ0Nvbm5lY3Rpb24gc3RyaW5nIHRvIEFaVVJFIElPVCBIVUInLCAhU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG4gICAgICAgIFNldHRpbmdzLmFkZChTZXR0aW5ncy5DT05TT0xFX0xFVkVMLCAnQ29uc29sZSBsb2cgbGV2ZWwnLCBjb25mLkNPTlNPTEVfTEVWRUwsICdpbmZvJyxcclxuICAgICAgICAgICAgJ0V2ZW50IGxldmVsIGxvZ2dlZCBvbiBjb25zb2xlOiBlcnJvciB8IGluZm8gfCBkZWJ1ZycsICFTZXR0aW5ncy5SRUFET05MWSk7XHJcbiAgICAgICAgU2V0dGluZ3MuYWRkKFNldHRpbmdzLkVSUk9SX0xFVkVMLCAnRXJyb3IgZmlsZSBsb2cgbGV2ZWwnLCBjb25mLkVSUk9SX0xFVkVMLCAnZXJyb3InLFxyXG4gICAgICAgICAgICAnRXZlbnQgbGV2ZWwgbG9nZ2VkIG9uIGZpbGU6IGVycm9yIHwgaW5mbyB8IGRlYnVnJywgIVNldHRpbmdzLlJFQURPTkxZKTtcclxuICAgICAgICBTZXR0aW5ncy5hZGQoU2V0dGluZ3MuRVJST1JfTE9HX0ZJTEUsICdBcHBsaWNhdGlvbiBlcnJvciBsb2cgZmlsZScsIGNvbmYuRVJST1JfTE9HX0ZJTEUsICdpdGVtcGVyLWVycm9yLmxvZycsXHJcbiAgICAgICAgICAgICdOYW1lIG9mIHRoZSBsb2cgZmlsZS4gWW91IGZpbmQgaXQgaW4gdGhlIGFwcGxpY2F0aW9uIHJvb3QgZGlyZWN0b3J5JywgU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG4gICAgICAgIFNldHRpbmdzLmFkZChTZXR0aW5ncy5IT1NUTkFNRSwgJ0hvc3RuYW1lJywgY29uZi5IT1NUTkFNRSwgJycsXHJcbiAgICAgICAgICAgICdUaGlzIGRldmljZSBcXCdzIGhvc3RuYW1lJywgU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG4gICAgICAgIFNldHRpbmdzLmFkZChTZXR0aW5ncy5JVEVNUEVSX1VSTCwgJ2lUZW1wZXIgVVJMJywgY29uZi5JVEVNUEVSX1VSTCwgJ2h0dHBzOi8vaXRlbXBlci5pbycsXHJcbiAgICAgICAgICAgICdUaGUgZGV2aWNlIHVzZVxcJ3MgdGhpcyBVUkwgd2hlbiBjb25uZWN0aW5nIHRvIGlUZW1wZXInLCAhU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG4gICAgICAgIFNldHRpbmdzLmFkZChTZXR0aW5ncy5QT0xMX0lOVEVSVkFMLCAnU2Vuc29yIHBvbGwgaW50ZXJ2YWwnLCBjb25mLlBPTExfSU5URVJWQUwsIDUwMDAsXHJcbiAgICAgICAgICAgICdJbnRlcnZhbCAobXMpIGJldHdlZW4gcG9sbGluZyB0aGUgc2Vuc29ycycsICFTZXR0aW5ncy5SRUFET05MWSk7XHJcbiAgICAgICAgU2V0dGluZ3MuYWRkKFNldHRpbmdzLldTX09SSUdJTiwgJ1dlYlNvY2tldCBvcmlnaW4nLCBjb25mLldTX09SSUdJTiwgJ2h0dHBzOi8vaXRlbXBlci5pbycsXHJcbiAgICAgICAgICAgICdPcmlnaW4gdXNlZCB3aGVuIGNvbm5lY3RpbmcgdG8gaVRlbXBlciB3aXRoIFdlYlNvY2tldHMnLCAhU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG4gICAgICAgIFNldHRpbmdzLmFkZChTZXR0aW5ncy5XU19VUkwsICdXZWJTb2NrZXQgVVJMJywgY29uZi5XU19VUkwsICd3c3M6Ly9pdGVtcGVyLmlvJyxcclxuICAgICAgICAgICAgJ1dlYlNvY2tldCBVUkwgdG8gaVRlbXBlcicsICFTZXR0aW5ncy5SRUFET05MWSk7XHJcbiAgICAgICAgU2V0dGluZ3MuYWRkKFNldHRpbmdzLlNIQVJFRF9BQ0NFU1NfS0VZLCAnU2hhcmVkIGFjY2VzcyBrZXknLCBjb25mLlNIQVJFRF9BQ0NFU1NfS0VZLCAnJyxcclxuICAgICAgICAgICAgJ0FkZCB0aGUgU2hhcmVkIGtleSB0byBhIGRldmljZSBvbiBhbiBpdGVtcGVyLmlvIHVzZXIgYWNjb3VudCAnICtcclxuICAgICAgICAgICAgJyB0byBhbGxvdyB0aGUgdGhpcyBkZXZpY2UgdG8gbG9nIHNlbnNvciBkYXRhIG9uIGl0ZW1wZXIuaW8nLCAhU2V0dGluZ3MuUkVBRE9OTFkpO1xyXG5cclxuXHJcbiAgICAgICAgLy8gSGVscGVyXHJcbiAgICAgICAgU2V0dGluZ3Mub25DaGFuZ2UoU2V0dGluZ3MuQ09OU09MRV9MRVZFTCwgKHNldHRpbmc6IFNldHRpbmcpPT4ge1xyXG4gICAgICAgICAgICBzZXRMZXZlbChzZXR0aW5nLnZhbHVlLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIG9uQ2hhbmdlKHNldHRpbmdOYW1lOiBzdHJpbmcsIHB1Ymxpc2g6IExpc3RlbmVyKSB7XHJcbiAgICAgICAgbG9nLmluZm8oJ1NldHRpbmdzLm9uQ2hhbmdlOiAnICsgc2V0dGluZ05hbWUpO1xyXG4gICAgICAgIFNldHRpbmdzLmxpc3RlbmVycy5wdXNoKHtzZXR0aW5nTmFtZSwgcHVibGlzaH0pO1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmcgPSBTZXR0aW5ncy5nZXQoc2V0dGluZ05hbWUpO1xyXG4gICAgICAgIGlmIChzZXR0aW5nKSB7XHJcbiAgICAgICAgICAgIHB1Ymxpc2goc2V0dGluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIHB1Ymxpc2goc2V0dGluZzogU2V0dGluZykge1xyXG4gICAgICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgU2V0dGluZ3MubGlzdGVuZXJzKSB7XHJcbiAgICAgICAgICAgIGlmIChsaXN0ZW5lci5zZXR0aW5nTmFtZSA9PT0gc2V0dGluZy5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBsaXN0ZW5lci5wdWJsaXNoKHNldHRpbmcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBhbGwoKTogU2V0dGluZ1tdIHtcclxuICAgICAgICBjb25zdCBhbGxTZXR0aW5nczogU2V0dGluZ1tdID0gW107XHJcbiAgICAgICAgU2V0dGluZ3MuZm9yRWFjaChzZXR0aW5nPT4gYWxsU2V0dGluZ3MucHVzaChzZXR0aW5nKSk7XHJcbiAgICAgICAgcmV0dXJuIGFsbFNldHRpbmdzO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBhZGQoICBuYW1lOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBTZXR0aW5nVmFsdWUgfCB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogU2V0dGluZ1ZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRvbmx5OiBib29sZWFuKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IFNldHRpbmdzLmNyZWF0ZShuYW1lLCBsYWJlbCwgdmFsdWUsIGRlZmF1bHRWYWx1ZSwgdGV4dCwgcmVhZG9ubHkpO1xyXG4gICAgICAgIFNldHRpbmdzLnNldChzZXR0aW5nKTtcclxuICAgICAgICBTZXR0aW5ncy5wdWJsaXNoKHNldHRpbmcpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGUoICAgbmFtZTogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBTZXR0aW5nVmFsdWUgfCB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNldHRpbmdWYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRvbmx5OiBib29sZWFuKTogU2V0dGluZyB7XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAge25hbWUsIGxhYmVsLCB2YWx1ZSwgZGVmYXVsdFZhbHVlLCB0ZXh0LCByZWFkb25seX07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtuYW1lLCBsYWJlbCwgdmFsdWU6IGRlZmF1bHRWYWx1ZSwgZGVmYXVsdFZhbHVlLCB0ZXh0LCByZWFkb25seX07XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIGdldChuYW1lOiBzdHJpbmcpOiBTZXR0aW5nIHtcclxuICAgICAgICBjb25zdCBzZXR0aW5nID0gIFNldHRpbmdzLm1hcC5nZXQobmFtZSk7XHJcbiAgICAgICAgaWYgKHNldHRpbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IobmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgdG9OdW0oc2V0dGluZzogU2V0dGluZyk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcihzZXR0aW5nLnZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdG9TdHJpbmcoc2V0dGluZzogU2V0dGluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5nLnZhbHVlID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZy52YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5nLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBoYXMobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIFNldHRpbmdzLm1hcC5oYXMobmFtZSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIHNldChzZXR0aW5nOiBTZXR0aW5nKSB7XHJcbiAgICAgICAgU2V0dGluZ3MubWFwLnNldChzZXR0aW5nLm5hbWUsIHNldHRpbmcpO1xyXG4gICAgICAgIGxvZy5pbmZvICgnU2V0dGluZ3Muc2V0OiAnICsgSlNPTi5zdHJpbmdpZnkoc2V0dGluZykpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgdXBkYXRlKG5hbWU6IHN0cmluZywgdmFsdWU6IFNldHRpbmdWYWx1ZSwgY2FsbGJhY2s6ICh1cGRhdGVkOiBib29sZWFuKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IFNldHRpbmdzLmdldChuYW1lKTtcclxuICAgICAgICBpZiAoc2V0dGluZyAmJiAhc2V0dGluZy5yZWFkb25seSkge1xyXG4gICAgICAgICAgICBzZXR0aW5nLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGxvZy5pbmZvKCdTZXR0aW5ncy51cGRhdGU6IHNldHRpbmcgJyArIG5hbWUgKyAnIGhhcyBuZXcgdmFsdWU6JyArIHNldHRpbmcudmFsdWUpO1xyXG4gICAgICAgICAgICBjYWxsYmFjayh0cnVlKTtcclxuICAgICAgICAgICAgdGhpcy5wdWJsaXNoKHNldHRpbmcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxvZy5lcnJvcignU2V0dGluZ3MudXBkYXRlOiBDYW5ub3QgdXBkYXRlIHJlYWRvbmx5IHNldHRpbmcnICsgbmFtZSArICcgdG8gJyArIHZhbHVlKTtcclxuICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvckVhY2goY2FsbGJhY2tmbjogKHNldHRpbmc6IFNldHRpbmcpID0+IHZvaWQpIHtcclxuICAgICAgICBTZXR0aW5ncy5tYXAuZm9yRWFjaChjYWxsYmFja2ZuKTtcclxuICAgIH1cclxufVxyXG5cclxuIl19
