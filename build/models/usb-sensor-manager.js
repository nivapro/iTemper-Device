"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var HID = require("node-hid");
var sensor_attributes_1 = require("./sensor-attributes");
var temper_8_1 = require("./temper-8");
var temper_gold_1 = require("./temper-gold");
var usb_controller_1 = require("./usb-controller");
var sensor_log_1 = require("./sensor-log");
var logger_1 = require("./../logger");
var DeviceConfig = (function () {
    function DeviceConfig() {
    }
    return DeviceConfig;
}());
exports.DeviceConfig = DeviceConfig;
var VID = 0x0C45;
var PID = 0x7401;
var TEMPER_GOLD = 'TEMPerV1.4';
var TEMPER_8 = 'TEMPer8_V1.5';
var INTERFACE = 1;
function isTemperGold(device) {
    return (device.vendorId === VID &&
        device.productId === PID &&
        device.product === TEMPER_GOLD &&
        device.interface === INTERFACE);
}
exports.isTemperGold = isTemperGold;
function isTemper8(device) {
    return (device.vendorId === VID &&
        device.productId === PID &&
        device.product === TEMPER_8 &&
        device.interface === INTERFACE);
}
exports.isTemper8 = isTemper8;
var USBSensorManager = (function () {
    function USBSensorManager() {
    }
    USBSensorManager.getLoggers = function () {
        return USBSensorManager.loggers;
    };
    USBSensorManager.factory = function () {
        HID.devices().find(function (device) {
            logger_1.log.info('device: ', JSON.stringify(device));
            if (isTemperGold(device) && device.path !== undefined) {
                logger_1.log.info('Sensor TEMPer Gold found');
                var hid = new HID.HID(device.path);
                var temperGold = new temper_gold_1.TemperGold();
                var attr = {
                    SN: 'TGold',
                    model: 'Temper Gold',
                    category: sensor_attributes_1.SensorCategory.Temperature,
                    accuracy: 2.0,
                    resolution: 1,
                    maxSampleRate: 1,
                };
                var logger = new sensor_log_1.SensorLog(attr, temperGold);
                logger.startLogging();
                USBSensorManager.loggers.push(logger);
                var temperGoldDevice = new usb_controller_1.USBController(hid, temperGold);
                USBSensorManager.devices.push(temperGoldDevice);
            }
            else if (isTemper8(device) && device.path !== undefined) {
                logger_1.log.info('Sensor TEMPer 8 found');
                var hid = new HID.HID(device.path);
                var temper8 = new temper_8_1.Temper8();
                var attr = {
                    SN: 'Temper8',
                    model: 'Temper 8',
                    category: sensor_attributes_1.SensorCategory.Temperature,
                    accuracy: 0.5,
                    resolution: 1,
                    maxSampleRate: 0.2,
                };
                var logger = new sensor_log_1.SensorLog(attr, temper8);
                logger.startLogging();
                USBSensorManager.loggers.push(logger);
                var temper8Device = new usb_controller_1.USBController(hid, temper8);
                USBSensorManager.devices.push(temper8Device);
            }
            return false;
        });
        if (USBSensorManager.devices.length === 0) {
            logger_1.log.error('Found 0 devices');
        }
        else {
            logger_1.log.info('Found %d devices', USBSensorManager.devices.length);
        }
    };
    USBSensorManager.devices = [];
    USBSensorManager.loggers = [];
    return USBSensorManager;
}());
exports.USBSensorManager = USBSensorManager;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbHMvdXNiLXNlbnNvci1tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOEJBQWlDO0FBQ2pDLHlEQUFxRDtBQUVyRCx1Q0FBcUM7QUFDckMsNkNBQTJDO0FBQzNDLG1EQUFpRDtBQUVqRCwyQ0FBeUM7QUFFekMsc0NBQWtDO0FBRWxDO0lBQUE7SUFLSSxDQUFDO0lBQUQsbUJBQUM7QUFBRCxDQUxKLEFBS0ssSUFBQTtBQUxRLG9DQUFZO0FBT3pCLElBQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQztBQUNuQixJQUFNLEdBQUcsR0FBRyxNQUFNLENBQUM7QUFDbkIsSUFBTSxXQUFXLEdBQUcsWUFBWSxDQUFDO0FBQ2pDLElBQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQztBQUNoQyxJQUFNLFNBQVMsR0FBRyxDQUFDLENBQUM7QUFHcEIsc0JBQTZCLE1BQWtCO0lBQzNDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEtBQUssR0FBRztRQUMzQixNQUFNLENBQUMsU0FBUyxLQUFLLEdBQUc7UUFDeEIsTUFBTSxDQUFDLE9BQU8sS0FBSyxXQUFXO1FBQzlCLE1BQU0sQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUxELG9DQUtDO0FBRUQsbUJBQTBCLE1BQWtCO0lBQ3hDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEtBQUssR0FBRztRQUMzQixNQUFNLENBQUMsU0FBUyxLQUFLLEdBQUc7UUFDeEIsTUFBTSxDQUFDLE9BQU8sS0FBSyxRQUFRO1FBQzNCLE1BQU0sQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUxELDhCQUtDO0FBQ0Q7SUFBQTtJQTJEQSxDQUFDO0lBdkRpQiwyQkFBVSxHQUF4QjtRQUNJLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7SUFDcEMsQ0FBQztJQUVhLHdCQUFPLEdBQXJCO1FBQ0ksR0FBRyxDQUFDLE9BQU8s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d0JBQU8sR0FBb0IsRUFBRSxDQUFDO0lBQzlCLHdCQUFPLEdBQWdCLEVBQUUsQ0FBQztJQXlEN0MsdUJBQUM7Q0EzREQsQUEyREMsSUFBQTtBQTNEWSw0Q0FBZ0IiLCJmaWxlIjoibW9kZWxzL3VzYi1zZW5zb3ItbWFuYWdlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBISUQgPSByZXF1aXJlKCdub2RlLWhpZCcpO1xyXG5pbXBvcnQgeyBTZW5zb3JDYXRlZ29yeSB9IGZyb20gJy4vc2Vuc29yLWF0dHJpYnV0ZXMnO1xyXG5cclxuaW1wb3J0IHsgVGVtcGVyOCB9IGZyb20gJy4vdGVtcGVyLTgnO1xyXG5pbXBvcnQgeyBUZW1wZXJHb2xkIH0gZnJvbSAnLi90ZW1wZXItZ29sZCc7XHJcbmltcG9ydCB7IFVTQkNvbnRyb2xsZXIgfSBmcm9tICcuL3VzYi1jb250cm9sbGVyJztcclxuXHJcbmltcG9ydCB7IFNlbnNvckxvZyB9IGZyb20gJy4vc2Vuc29yLWxvZyc7XHJcblxyXG5pbXBvcnQgeyBsb2cgfSBmcm9tICcuLy4uL2xvZ2dlcic7XHJcblxyXG5leHBvcnQgY2xhc3MgRGV2aWNlQ29uZmlnIHtcclxuICAgICAgICB2ZW5kb3JJZDogbnVtYmVyO1xyXG4gICAgICAgIHByb2R1Y3RJZDogbnVtYmVyO1xyXG4gICAgICAgIHByb2R1Y3Q6IHN0cmluZztcclxuICAgICAgICBpbnRlcmZhY2U6IG51bWJlcjtcclxuICAgIH1cclxuXHJcbmNvbnN0IFZJRCA9IDB4MEM0NTtcclxuY29uc3QgUElEID0gMHg3NDAxO1xyXG5jb25zdCBURU1QRVJfR09MRCA9ICdURU1QZXJWMS40JztcclxuY29uc3QgVEVNUEVSXzggPSAnVEVNUGVyOF9WMS41JztcclxuY29uc3QgSU5URVJGQUNFID0gMTtcclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNUZW1wZXJHb2xkKGRldmljZTogSElELkRldmljZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChkZXZpY2UudmVuZG9ySWQgPT09IFZJRCAmJlxyXG4gICAgICAgIGRldmljZS5wcm9kdWN0SWQgPT09IFBJRCAmJlxyXG4gICAgICAgIGRldmljZS5wcm9kdWN0ID09PSBURU1QRVJfR09MRCAmJlxyXG4gICAgICAgIGRldmljZS5pbnRlcmZhY2UgPT09IElOVEVSRkFDRSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1RlbXBlcjgoZGV2aWNlOiBISUQuRGV2aWNlKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKGRldmljZS52ZW5kb3JJZCA9PT0gVklEICYmXHJcbiAgICAgICAgZGV2aWNlLnByb2R1Y3RJZCA9PT0gUElEICYmXHJcbiAgICAgICAgZGV2aWNlLnByb2R1Y3QgPT09IFRFTVBFUl84ICYmXHJcbiAgICAgICAgZGV2aWNlLmludGVyZmFjZSA9PT0gSU5URVJGQUNFKTtcclxufVxyXG5leHBvcnQgY2xhc3MgVVNCU2Vuc29yTWFuYWdlciB7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBkZXZpY2VzOiBVU0JDb250cm9sbGVyW10gPSBbXTtcclxuICAgIHByaXZhdGUgc3RhdGljIGxvZ2dlcnM6IFNlbnNvckxvZ1tdID0gW107XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBnZXRMb2dnZXJzKCk6IFNlbnNvckxvZ1tdIHtcclxuICAgICAgICByZXR1cm4gVVNCU2Vuc29yTWFuYWdlci5sb2dnZXJzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZmFjdG9yeSgpOiB2b2lkIHtcclxuICAgICAgICBISUQuZGV2aWNlcygpLmZpbmQoZGV2aWNlID0+IHtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ2RldmljZTogJywgSlNPTi5zdHJpbmdpZnkoZGV2aWNlKSk7XHJcbiAgICAgICAgICAgIGlmIChpc1RlbXBlckdvbGQoZGV2aWNlKSAmJiBkZXZpY2UucGF0aCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBsb2cuaW5mbygnU2Vuc29yIFRFTVBlciBHb2xkIGZvdW5kJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoaWQgPSBuZXcgSElELkhJRChkZXZpY2UucGF0aCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wZXJHb2xkID0gbmV3IFRlbXBlckdvbGQoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGF0dHIgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNOOiAnVEdvbGQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogJ1RlbXBlciBHb2xkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IFNlbnNvckNhdGVnb3J5LlRlbXBlcmF0dXJlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2N1cmFjeTogMi4wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhTYW1wbGVSYXRlOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2dnZXIgPSBuZXcgU2Vuc29yTG9nKGF0dHIsIHRlbXBlckdvbGQpO1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnN0YXJ0TG9nZ2luZygpO1xyXG4gICAgICAgICAgICAgICAgVVNCU2Vuc29yTWFuYWdlci5sb2dnZXJzLnB1c2gobG9nZ2VyKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBlckdvbGREZXZpY2UgPSBuZXcgVVNCQ29udHJvbGxlciAoaGlkLCB0ZW1wZXJHb2xkKTtcclxuICAgICAgICAgICAgICAgIFVTQlNlbnNvck1hbmFnZXIuZGV2aWNlcy5wdXNoKHRlbXBlckdvbGREZXZpY2UpO1xyXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNUZW1wZXI4KGRldmljZSkgJiYgZGV2aWNlLnBhdGggIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbG9nLmluZm8oJ1NlbnNvciBURU1QZXIgOCBmb3VuZCcpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGlkID0gbmV3IEhJRC5ISUQoZGV2aWNlLnBhdGgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcGVyOCA9IG5ldyBUZW1wZXI4KCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhdHRyID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFNOOiAnVGVtcGVyOCcsXHJcbiAgICAgICAgICAgICAgICAgICAgbW9kZWw6ICdUZW1wZXIgOCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IFNlbnNvckNhdGVnb3J5LlRlbXBlcmF0dXJlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFjY3VyYWN5OiAwLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICBtYXhTYW1wbGVSYXRlOiAwLjIsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbG9nZ2VyID0gbmV3IFNlbnNvckxvZyhhdHRyLCB0ZW1wZXI4KTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5zdGFydExvZ2dpbmcoKTtcclxuICAgICAgICAgICAgICAgIFVTQlNlbnNvck1hbmFnZXIubG9nZ2Vycy5wdXNoKGxvZ2dlcik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wZXI4RGV2aWNlID0gbmV3IFVTQkNvbnRyb2xsZXIgKGhpZCwgdGVtcGVyOCk7XHJcbiAgICAgICAgICAgICAgICBVU0JTZW5zb3JNYW5hZ2VyLmRldmljZXMucHVzaCh0ZW1wZXI4RGV2aWNlKTtcclxuICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoVVNCU2Vuc29yTWFuYWdlci5kZXZpY2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICBsb2cuZXJyb3IoJ0ZvdW5kIDAgZGV2aWNlcycpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxvZy5pbmZvKCdGb3VuZCAlZCBkZXZpY2VzJywgVVNCU2Vuc29yTWFuYWdlci5kZXZpY2VzLmxlbmd0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbn1cclxuIl19
