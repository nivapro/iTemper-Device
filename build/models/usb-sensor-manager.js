"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var HID = require("node-hid");
var sensor_attributes_1 = require("./sensor-attributes");
var temper_8_1 = require("./temper-8");
var temper_gold_1 = require("./temper-gold");
var usb_controller_1 = require("./usb-controller");
var sensor_log_1 = require("./sensor-log");
var logger_1 = require("./../logger");
var DeviceConfig = (function () {
    function DeviceConfig() {
    }
    return DeviceConfig;
}());
exports.DeviceConfig = DeviceConfig;
var VID = 0x0C45;
var PID = 0x7401;
var TEMPER_GOLD = 'TEMPerV1.4';
var TEMPER_8 = 'TEMPer8_V1.5';
var INTERFACE = 1;
function isTemperGold(device) {
    return (device.vendorId === VID &&
        device.productId === PID &&
        device.product === TEMPER_GOLD &&
        device.interface === INTERFACE);
}
exports.isTemperGold = isTemperGold;
function isTemper8(device) {
    return (device.vendorId === VID &&
        device.productId === PID &&
        device.product === TEMPER_8 &&
        device.interface === INTERFACE);
}
exports.isTemper8 = isTemper8;
var USBSensorManager = (function () {
    function USBSensorManager() {
    }
    USBSensorManager.getLoggers = function () {
        return USBSensorManager.loggers;
    };
    USBSensorManager.factory = function () {
        HID.devices().find(function (device) {
            logger_1.log.debug('device: ', device);
            if (isTemperGold(device) && device.path !== undefined) {
                logger_1.log.info('Sensor TEMPer Gold found: ', device);
                var hid = new HID.HID(device.path);
                var temperGold = new temper_gold_1.TemperGold();
                var attr = new sensor_attributes_1.SensorAttributes('TGold', 'Temper Gold', sensor_attributes_1.SensorCategory.Temperature, 2.0, 1, 1);
                var logger = new sensor_log_1.SensorLog(attr, temperGold);
                logger.startLogging();
                USBSensorManager.loggers.push(logger);
                var temperGoldDevice = new usb_controller_1.USBController(hid, temperGold);
                USBSensorManager.devices.push(temperGoldDevice);
            }
            else if (isTemper8(device) && device.path !== undefined) {
                logger_1.log.info('Sensor TEMPer 8 found: ', device);
                var hid = new HID.HID(device.path);
                var temper8 = new temper_8_1.Temper8();
                var attr = {
                    SN: 'Temper8',
                    model: 'Temper 8',
                    category: sensor_attributes_1.SensorCategory.Temperature,
                    accuracy: 0.5,
                    resolution: 1,
                    maxSampleRate: 0.2,
                };
                var logger = new sensor_log_1.SensorLog(attr, temper8);
                logger.startLogging();
                USBSensorManager.loggers.push(logger);
                var temper8Device = new usb_controller_1.USBController(hid, temper8);
                USBSensorManager.devices.push(temper8Device);
            }
            return false;
        });
        if (USBSensorManager.devices.length === 0) {
            logger_1.log.error('Found 0 devices');
        }
        else {
            logger_1.log.info('Found %d device(s)', USBSensorManager.devices.length);
        }
    };
    USBSensorManager.setPollingInterval = function (ms) {
        logger_1.log.debug('USBSensorManager.setPollingInterval:', ms);
        for (var _i = 0, _a = USBSensorManager.devices; _i < _a.length; _i++) {
            var device = _a[_i];
            logger_1.log.debug('USBSensorManager.setPollingInterval - device');
            device.setPollingInterval(ms);
        }
    };
    USBSensorManager.devices = [];
    USBSensorManager.loggers = [];
    return USBSensorManager;
}());
exports.USBSensorManager = USBSensorManager;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbHMvdXNiLXNlbnNvci1tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOEJBQWlDO0FBQ2pDLHlEQUF1RTtBQUV2RSx1Q0FBcUM7QUFDckMsNkNBQTJDO0FBQzNDLG1EQUFpRDtBQUVqRCwyQ0FBeUM7QUFFekMsc0NBQWtDO0FBRWxDO0lBQUE7SUFLSSxDQUFDO0lBQUQsbUJBQUM7QUFBRCxDQUxKLEFBS0ssSUFBQTtBQUxRLG9DQUFZO0FBT3pCLElBQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQztBQUNuQixJQUFNLEdBQUcsR0FBRyxNQUFNLENBQUM7QUFDbkIsSUFBTSxXQUFXLEdBQUcsWUFBWSxDQUFDO0FBQ2pDLElBQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQztBQUNoQyxJQUFNLFNBQVMsR0FBRyxDQUFDLENBQUM7QUFHcEIsc0JBQTZCLE1BQWtCO0lBQzNDLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxLQUFLLEdBQUc7UUFDM0IsTUFBTSxDQUFDLFNBQVMsS0FBSyxHQUFHO1FBQ3hCLE1BQU0sQ0FBQyxPQUFPLEtBQUssV0FBVztRQUM5QixNQUFNLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQyxDQUFDO0FBQ3hDLENBQUM7QUFMRCxvQ0FLQztBQUVELG1CQUEwQixNQUFrQjtJQUN4QyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsS0FBSyxHQUFHO1FBQzNCLE1BQU0sQ0FBQyxTQUFTLEtBQUssR0FBRztRQUN4QixNQUFNLENBQUMsT0FBTyxLQUFLLFFBQVE7UUFDM0IsTUFBTSxDQUFDLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQztBQUN4QyxDQUFDO0FBTEQsOEJBS0M7QUFDRDtJQUFBO0lBK0RBLENBQUM7SUEzRGlCLDJCQUFVLEdBQXhCO1FBQ0ksT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7SUFDcEMsQ0FBQztJQUVhLHdCQUFPLEdBQXJCO1FBQ0ksR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFBLE1BQU07WUFDckIsWUFBRyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDOUIsSUFBSSxZQUFZLENBQUMsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxTQUFTLEVBQUU7Z0JBQ25ELFlBQUcsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQy9DLElBQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3JDLElBQU0sVUFBVSxHQUFHLElBQUksd0JBQVUsRUFBRSxDQUFDO2dCQUNwQyxJQUFNLElBQUksR0FBRyxJQUFJLG9DQUFnQixDQUN6QixPQUFPLEVBQ1AsYUFBYSxFQUNiLGtDQUFjLENBQUMsV0FBVyxFQUMxQixHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNuQixJQUFNLE1BQU0sR0FBRyxJQUFJLHNCQUFTLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO2dCQUMvQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUM7Z0JBQ3RCLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3RDLElBQU0sZ0JBQWdCLEdBQUcsSUFBSSw4QkFBYSxDQUFFLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztnQkFDN0QsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2FBRW5EO2lCQUFNLElBQUksU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFO2dCQUN2RCxZQUFHLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUM1QyxJQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNyQyxJQUFNLE9BQU8sR0FBRyxJQUFJLGtCQUFPLEVBQUUsQ0FBQztnQkFDOUIsSUFBTSxJQUFJLEdBQUc7b0JBQ1QsRUFBRSxFQUFFLFNBQVM7b0JBQ2IsS0FBSyxFQUFFLFVBQVU7b0JBQ2pCLFFBQVEsRUFBRSxrQ0FBYyxDQUFDLFdBQVc7b0JBQ3BDLFFBQVEsRUFBRSxHQUFHO29CQUNiLFVBQVUsRUFBRSxDQUFDO29CQUNiLGFBQWEsRUFBRSxHQUFHO2lCQUNyQixDQUFDO2dCQUNGLElBQU0sTUFBTSxHQUFHLElBQUksc0JBQVMsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQzVDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQztnQkFDdEIsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdEMsSUFBTSxhQUFhLEdBQUcsSUFBSSw4QkFBYSxDQUFFLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDdkQsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQzthQUVoRDtZQUVELE9BQU8sS0FBSyxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN2QyxZQUFHLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUM7U0FDaEM7YUFBTTtZQUNILFlBQUcsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ25FO0lBRUwsQ0FBQztJQUVhLG1DQUFrQixHQUFoQyxVQUFpQyxFQUFVO1FBQ3ZDLFlBQUcsQ0FBQyxLQUFLLENBQUMsc0NBQXNDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDdEQsS0FBcUIsVUFBd0IsRUFBeEIsS0FBQSxnQkFBZ0IsQ0FBQyxPQUFPLEVBQXhCLGNBQXdCLEVBQXhCLElBQXdCLEVBQUU7WUFBMUMsSUFBTSxNQUFNLFNBQUE7WUFDYixZQUFHLENBQUMsS0FBSyxDQUFDLDhDQUE4QyxDQUFDLENBQUM7WUFDMUQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2pDO0lBQ0wsQ0FBQztJQTdEYyx3QkFBTyxHQUFvQixFQUFFLENBQUM7SUFDOUIsd0JBQU8sR0FBZ0IsRUFBRSxDQUFDO0lBNkQ3Qyx1QkFBQztDQS9ERCxBQStEQyxJQUFBO0FBL0RZLDRDQUFnQiIsImZpbGUiOiJtb2RlbHMvdXNiLXNlbnNvci1tYW5hZ2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEhJRCA9IHJlcXVpcmUoJ25vZGUtaGlkJyk7XHJcbmltcG9ydCB7IFNlbnNvckF0dHJpYnV0ZXMsIFNlbnNvckNhdGVnb3J5IH0gZnJvbSAnLi9zZW5zb3ItYXR0cmlidXRlcyc7XHJcblxyXG5pbXBvcnQgeyBUZW1wZXI4IH0gZnJvbSAnLi90ZW1wZXItOCc7XHJcbmltcG9ydCB7IFRlbXBlckdvbGQgfSBmcm9tICcuL3RlbXBlci1nb2xkJztcclxuaW1wb3J0IHsgVVNCQ29udHJvbGxlciB9IGZyb20gJy4vdXNiLWNvbnRyb2xsZXInO1xyXG5cclxuaW1wb3J0IHsgU2Vuc29yTG9nIH0gZnJvbSAnLi9zZW5zb3ItbG9nJztcclxuXHJcbmltcG9ydCB7IGxvZyB9IGZyb20gJy4vLi4vbG9nZ2VyJztcclxuXHJcbmV4cG9ydCBjbGFzcyBEZXZpY2VDb25maWcge1xyXG4gICAgICAgIHZlbmRvcklkOiBudW1iZXI7XHJcbiAgICAgICAgcHJvZHVjdElkOiBudW1iZXI7XHJcbiAgICAgICAgcHJvZHVjdDogc3RyaW5nO1xyXG4gICAgICAgIGludGVyZmFjZTogbnVtYmVyO1xyXG4gICAgfVxyXG5cclxuY29uc3QgVklEID0gMHgwQzQ1O1xyXG5jb25zdCBQSUQgPSAweDc0MDE7XHJcbmNvbnN0IFRFTVBFUl9HT0xEID0gJ1RFTVBlclYxLjQnO1xyXG5jb25zdCBURU1QRVJfOCA9ICdURU1QZXI4X1YxLjUnO1xyXG5jb25zdCBJTlRFUkZBQ0UgPSAxO1xyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1RlbXBlckdvbGQoZGV2aWNlOiBISUQuRGV2aWNlKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKGRldmljZS52ZW5kb3JJZCA9PT0gVklEICYmXHJcbiAgICAgICAgZGV2aWNlLnByb2R1Y3RJZCA9PT0gUElEICYmXHJcbiAgICAgICAgZGV2aWNlLnByb2R1Y3QgPT09IFRFTVBFUl9HT0xEICYmXHJcbiAgICAgICAgZGV2aWNlLmludGVyZmFjZSA9PT0gSU5URVJGQUNFKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzVGVtcGVyOChkZXZpY2U6IEhJRC5EZXZpY2UpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAoZGV2aWNlLnZlbmRvcklkID09PSBWSUQgJiZcclxuICAgICAgICBkZXZpY2UucHJvZHVjdElkID09PSBQSUQgJiZcclxuICAgICAgICBkZXZpY2UucHJvZHVjdCA9PT0gVEVNUEVSXzggJiZcclxuICAgICAgICBkZXZpY2UuaW50ZXJmYWNlID09PSBJTlRFUkZBQ0UpO1xyXG59XHJcbmV4cG9ydCBjbGFzcyBVU0JTZW5zb3JNYW5hZ2VyIHtcclxuICAgIHByaXZhdGUgc3RhdGljIGRldmljZXM6IFVTQkNvbnRyb2xsZXJbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgbG9nZ2VyczogU2Vuc29yTG9nW10gPSBbXTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldExvZ2dlcnMoKTogU2Vuc29yTG9nW10ge1xyXG4gICAgICAgIHJldHVybiBVU0JTZW5zb3JNYW5hZ2VyLmxvZ2dlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBmYWN0b3J5KCk6IHZvaWQge1xyXG4gICAgICAgIEhJRC5kZXZpY2VzKCkuZmluZChkZXZpY2UgPT4ge1xyXG4gICAgICAgICAgICBsb2cuZGVidWcoJ2RldmljZTogJywgZGV2aWNlKTtcclxuICAgICAgICAgICAgaWYgKGlzVGVtcGVyR29sZChkZXZpY2UpICYmIGRldmljZS5wYXRoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGxvZy5pbmZvKCdTZW5zb3IgVEVNUGVyIEdvbGQgZm91bmQ6ICcsIGRldmljZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoaWQgPSBuZXcgSElELkhJRChkZXZpY2UucGF0aCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wZXJHb2xkID0gbmV3IFRlbXBlckdvbGQoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGF0dHIgPSBuZXcgU2Vuc29yQXR0cmlidXRlcyAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdUR29sZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdUZW1wZXIgR29sZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNlbnNvckNhdGVnb3J5LlRlbXBlcmF0dXJlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAyLjAsIDEsIDEpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbG9nZ2VyID0gbmV3IFNlbnNvckxvZyhhdHRyLCB0ZW1wZXJHb2xkKTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5zdGFydExvZ2dpbmcoKTtcclxuICAgICAgICAgICAgICAgIFVTQlNlbnNvck1hbmFnZXIubG9nZ2Vycy5wdXNoKGxvZ2dlcik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wZXJHb2xkRGV2aWNlID0gbmV3IFVTQkNvbnRyb2xsZXIgKGhpZCwgdGVtcGVyR29sZCk7XHJcbiAgICAgICAgICAgICAgICBVU0JTZW5zb3JNYW5hZ2VyLmRldmljZXMucHVzaCh0ZW1wZXJHb2xkRGV2aWNlKTtcclxuICAgICAgICAgICAgICAgIC8vIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzVGVtcGVyOChkZXZpY2UpICYmIGRldmljZS5wYXRoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGxvZy5pbmZvKCdTZW5zb3IgVEVNUGVyIDggZm91bmQ6ICcsIGRldmljZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoaWQgPSBuZXcgSElELkhJRChkZXZpY2UucGF0aCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wZXI4ID0gbmV3IFRlbXBlcjgoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGF0dHIgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU046ICdUZW1wZXI4JyxcclxuICAgICAgICAgICAgICAgICAgICBtb2RlbDogJ1RlbXBlciA4JyxcclxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogU2Vuc29yQ2F0ZWdvcnkuVGVtcGVyYXR1cmUsXHJcbiAgICAgICAgICAgICAgICAgICAgYWNjdXJhY3k6IDAuNSxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIG1heFNhbXBsZVJhdGU6IDAuMixcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2dnZXIgPSBuZXcgU2Vuc29yTG9nKGF0dHIsIHRlbXBlcjgpO1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnN0YXJ0TG9nZ2luZygpO1xyXG4gICAgICAgICAgICAgICAgVVNCU2Vuc29yTWFuYWdlci5sb2dnZXJzLnB1c2gobG9nZ2VyKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBlcjhEZXZpY2UgPSBuZXcgVVNCQ29udHJvbGxlciAoaGlkLCB0ZW1wZXI4KTtcclxuICAgICAgICAgICAgICAgIFVTQlNlbnNvck1hbmFnZXIuZGV2aWNlcy5wdXNoKHRlbXBlcjhEZXZpY2UpO1xyXG4gICAgICAgICAgICAgICAvLyByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChVU0JTZW5zb3JNYW5hZ2VyLmRldmljZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIGxvZy5lcnJvcignRm91bmQgMCBkZXZpY2VzJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbG9nLmluZm8oJ0ZvdW5kICVkIGRldmljZShzKScsIFVTQlNlbnNvck1hbmFnZXIuZGV2aWNlcy5sZW5ndGgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBzZXRQb2xsaW5nSW50ZXJ2YWwobXM6IG51bWJlcikge1xyXG4gICAgICAgIGxvZy5kZWJ1ZygnVVNCU2Vuc29yTWFuYWdlci5zZXRQb2xsaW5nSW50ZXJ2YWw6JywgbXMpO1xyXG4gICAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIFVTQlNlbnNvck1hbmFnZXIuZGV2aWNlcykge1xyXG4gICAgICAgICAgICBsb2cuZGVidWcoJ1VTQlNlbnNvck1hbmFnZXIuc2V0UG9sbGluZ0ludGVydmFsIC0gZGV2aWNlJyk7XHJcbiAgICAgICAgICAgIGRldmljZS5zZXRQb2xsaW5nSW50ZXJ2YWwobXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
