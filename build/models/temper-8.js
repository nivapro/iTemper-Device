"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var sensor_attributes_1 = require("./sensor-attributes");
var sensor_state_1 = require("./sensor-state");
var settings_1 = require("./settings");
var logger_1 = require("../logger");
var Temper8 = (function (_super) {
    __extends(Temper8, _super);
    function Temper8(config) {
        var _this = _super.call(this, new sensor_attributes_1.SensorAttributes(Temper8.SN(config), Temper8.model(config), sensor_attributes_1.SensorCategory.Temperature, 0.5, 1, 0.2)) || this;
        _this.nextSensor = 0;
        settings_1.Settings.onChange(settings_1.Settings.SERIAL_NUMBER, function (setting) {
            _this.attr.SN = setting.value.toString();
            logger_1.log.debug('SensorLog.settingChanged: SERIAL_NUMBER=' + _this.attr.SN);
        });
        return _this;
    }
    Temper8.model = function (config) {
        return config.manufacturer || '' + config.product || 'Temper 8';
    };
    Temper8.SN = function (config) {
        return config.serialNumber || settings_1.Settings.get(settings_1.Settings.SERIAL_NUMBER).value.toString();
    };
    Temper8.prototype.initWriteReport = function () {
        this.nextSensor = 0;
        return [this.usedPortsRequest(), this.temperatureRequest(this.nextSensor)];
    };
    Temper8.prototype.readReport = function (data) {
        try {
            if (this.matchUsedPorts(data)) {
                logger_1.log.debug('+++ Temper8.matchUsedPorts:', data);
                var response = this.temperatureRequest(this.sensors[this.nextSensor].s.getPort());
                this.nextSensor += 1;
                return response;
            }
            else if (this.matchTemperature(data)) {
                logger_1.log.debug('+++ Temper8.matchTemperature:', data);
                if (this.nextSensor < this.sensors.length) {
                    var response = this.temperatureRequest(this.sensors[this.nextSensor].s.getPort());
                    this.nextSensor += 1;
                    return response;
                }
                else {
                    this.nextSensor = 0;
                    return this.check03Request();
                }
            }
            else if (this.matchCheck03(data)) {
                return this.check05Request();
            }
            else if (this.matchCheck05(data)) {
                return this.check0DRequest();
            }
            else if (this.matchCheck0D(data)) {
                return [];
            }
            else if (this.matchCheckFF(data)) {
                logger_1.log.error('*** Temper8.matchCheckFF: restart?');
                throw Error('*** Temper8.matchCheckFF');
            }
        }
        catch (e) {
            logger_1.log.error(e);
        }
        return [];
    };
    Temper8.prototype.usedPortsRequest = function () {
        return [0x01, 0x8A, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00];
    };
    Temper8.prototype.getUsedPorts = function (total, used) {
        var usedPorts = new Array(total);
        var bits = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80];
        var portIndex = 0;
        for (var bit = 0; bit < bits.length; bit++) {
            if ((used & bits[bit]) === bits[bit]) {
                var port = bit;
                usedPorts[portIndex] = port;
                logger_1.log.debug('+++ Temper8: Sensor connected to port: ' + port);
                portIndex += 1;
            }
        }
        return usedPorts;
    };
    Temper8.prototype.matchUsedPorts = function (data) {
        if (data.length === 8
            && data[0] === 0x8A
            && data[1] === 0x08
            && data[2] === 0x01
            && data[3] === 0x01) {
            this.connectSensors(this.getUsedPorts(data[4], data[5]));
            return true;
        }
        else {
            return false;
        }
    };
    Temper8.prototype.temperatureRequest = function (port) {
        return [0x01, 0x80, 0x01, 0x00, 0x00, port, 0x00, 0x00];
    };
    Temper8.prototype.matchTemperature = function (data) {
        if (data.length === 8
            && data[0] === 0x80
            && data[1] === 0x08
            && data[2] === 0x01) {
            logger_1.log.debug('+++ matchTemperature, data: %d', data);
            var port = data[4];
            var msb = data[5];
            var lsb = data[6];
            var temperatureCelsius = this.GetTemperature(msb, lsb);
            this.updateSensor(port, temperatureCelsius);
            return true;
        }
        else {
            return false;
        }
    };
    Temper8.prototype.GetTemperature = function (msb, lsb) {
        var temperature = 0.0;
        var reading = (lsb & 0xFF) + (msb << 8);
        var result = 1;
        if ((reading & 0x8000) > 0) {
            reading = (reading ^ 0xffff) + 1;
            result = -1;
        }
        temperature = result * reading / 16.0;
        return temperature;
    };
    Temper8.prototype.check03Request = function () {
        return [0x01, 0x8A, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00];
    };
    Temper8.prototype.matchCheck03 = function (data) {
        if (data.length === 8
            && data[0] === 0x8A
            && data[1] === 0x08
            && data[2] === 0x01
            && data[3] === 0x03) {
            return true;
        }
        else {
            return false;
        }
    };
    Temper8.prototype.check05Request = function () {
        return [0x01, 0x8A, 0x01, 0x05, 0x00, 0x00, 0x00, 0x00];
    };
    Temper8.prototype.matchCheck05 = function (data) {
        if (data.length === 8
            && data[0] === 0x8A
            && data[1] === 0x08
            && data[2] === 0x01
            && data[3] === 0x05) {
            return true;
        }
        else {
            return false;
        }
    };
    Temper8.prototype.check0DRequest = function () {
        return [0x01, 0x8A, 0x01, 0x0D, 0x00, 0x00, 0x00, 0x00];
    };
    Temper8.prototype.matchCheck0D = function (data) {
        if (data.length === 8
            && data[0] === 0x8A
            && data[1] === 0x08
            && data[2] === 0x01
            && data[3] === 0x0D) {
            return true;
        }
        else {
            return false;
        }
    };
    Temper8.prototype.matchCheckFF = function (data) {
        if (data.length === 8
            && data[0] === 0xFF
            && data[1] === 0xFF
            && data[2] === 0xFF
            && data[3] === 0xFF) {
            return true;
        }
        else {
            return false;
        }
    };
    return Temper8;
}(sensor_state_1.SensorState));
exports.Temper8 = Temper8;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbHMvdGVtcGVyLTgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EseURBQXVFO0FBQ3ZFLCtDQUE2QztBQUc3Qyx1Q0FBNkM7QUFFN0Msb0NBQWdDO0FBTWhDO0lBQTZCLDJCQUFXO0lBTXBDLGlCQUFZLE1BQWlCO1FBQTdCLFlBQ0ksa0JBQU0sSUFBSSxvQ0FBZ0IsQ0FDdEIsT0FBTyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFDbEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFDckIsa0NBQWMsQ0FBQyxXQUFXLEVBQzFCLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsU0FNcEI7UUFZUyxnQkFBVSxHQUFXLENBQUMsQ0FBQztRQWhCN0IsbUJBQVEsQ0FBQyxRQUFRLENBQUMsbUJBQVEsQ0FBQyxhQUFhLEVBQUUsVUFBQyxPQUFnQjtZQUN2RCxLQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3hDLFlBQUcsQ0FBQyxLQUFLLENBQUMsMENBQTBDLEdBQUcsS0FBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN6RSxDQUFDLENBQUMsQ0FBQzs7SUFDUCxDQUFDO0lBRWMsYUFBSyxHQUFwQixVQUFxQixNQUFpQjtRQUNsQyxPQUFPLE1BQU0sQ0FBQyxZQUFZLElBQUksRUFBRSxHQUFHLE1BQU0sQ0FBQyxPQUFPLElBQUksVUFBVSxDQUFDO0lBQ3BFLENBQUM7SUFFYyxVQUFFLEdBQWpCLFVBQWtCLE1BQWlCO1FBQy9CLE9BQU8sTUFBTSxDQUFDLFlBQVksSUFBSSxtQkFBUSxDQUFDLEdBQUcsQ0FBQyxtQkFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUN4RixDQUFDO0lBUU0saUNBQWUsR0FBdEI7UUFHSSxJQUFJLENBQUMsVUFBVSxH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O0lBQzVELENBQUM7SUFDUSw4QkFBWSxHQUFyQixVQUFzQixJQUFjO1FBQ2hDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDO2VBQ2QsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUk7ZUFDaEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUk7ZUFDaEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUk7ZUFDaEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUNyQixPQUFPLElBQUksQ0FBQztTQUNmO2FBQU07WUFDSCxPQUFPLEtBQUssQ0FBQztTQUNoQjtJQUNMLENBQUM7SUFJUSw4QkFBWSxHQUFyQixVQUFzQixJQUFjO1FBQ2hDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDO2VBQ2QsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUk7ZUFDaEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUk7ZUFDaEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUk7ZUFDaEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUNyQixPQUFPLElBQUksQ0FBQztTQUNmO2FBQU07WUFDSCxPQUFPLEtBQUssQ0FBQztTQUNoQjtJQUNMLENBQUM7SUFFTCxjQUFDO0FBQUQsQ0F4T0EsQUF3T0MsQ0F4TzRCLDBCQUFXLEdBd092QztBQXhPWSwwQkFBTyIsImZpbGUiOiJtb2RlbHMvdGVtcGVyLTguanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgU2Vuc29yQXR0cmlidXRlcywgU2Vuc29yQ2F0ZWdvcnkgfSBmcm9tICcuL3NlbnNvci1hdHRyaWJ1dGVzJztcclxuaW1wb3J0IHsgU2Vuc29yU3RhdGUgfSBmcm9tICcuL3NlbnNvci1zdGF0ZSc7XHJcbmltcG9ydCB7IFVTQkNvbmZpZywgVVNCUmVwb3J0ZXIgfSBmcm9tICcuL3VzYi1kZXZpY2UnO1xyXG5cclxuaW1wb3J0IHtTZXR0aW5nLCBTZXR0aW5nc30gZnJvbSAnLi9zZXR0aW5ncyc7XHJcblxyXG5pbXBvcnQgeyBsb2cgfSBmcm9tICcuLi9sb2dnZXInO1xyXG5cclxuXHJcbi8vIFRlbXBlcjggcGFyc2VyIHVuZGVyc3RhbmRzIEhJRCByZXBvcnRzIGZyb20gVGVtcGVyOCBkZXZpY2VzXHJcbi8vIEluZGVwZW5kZW50IG9mIFVTQiBsaWIgdXNlZC5cclxuXHJcbmV4cG9ydCBjbGFzcyBUZW1wZXI4IGV4dGVuZHMgU2Vuc29yU3RhdGUgaW1wbGVtZW50cyBVU0JSZXBvcnRlciB7XHJcbiAgICAvLyBEZXZpY2UgaGFzIDggcG9ydHMsIGVhY2ggb2Ygd2hpY2ggY2FuIGhvbGQgYSAxLXdpcmUgdGVtcGVyYXR1cmUgc2Vuc29yXHJcbiAgICAvLyBUaGUgc2Vuc29ycyBhcmUgcG9sbGVkIGluIHNlcXVlbmNlLCBzdGFydGluZyBmcm9tIHBvcnQgMCB0byBwb3J0IDcuXHJcbiAgICAvLyBXZSBkbyBub3Qga25vdyBob3cgbWFueSBzZW5zb3JzIGFyZSBjb25uZWN0ZWQgdW50aWwgd2UgcmVjZWl2ZWQgdGhlIGNvbmZpZ1xyXG4gICAgLy8gaW4gYSBVU0IgSElEIHJlcG9ydFxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZzogVVNCQ29uZmlnKSB7XHJcbiAgICAgICAgc3VwZXIobmV3IFNlbnNvckF0dHJpYnV0ZXMgKFxyXG4gICAgICAgICAgICBUZW1wZXI4LlNOKGNvbmZpZyksXHJcbiAgICAgICAgICAgIFRlbXBlcjgubW9kZWwoY29uZmlnKSxcclxuICAgICAgICAgICAgU2Vuc29yQ2F0ZWdvcnkuVGVtcGVyYXR1cmUsXHJcbiAgICAgICAgICAgIDAuNSwgMSwgMC4yKSk7XHJcblxyXG4gICAgICAgIFNldHRpbmdzLm9uQ2hhbmdlKFNldHRpbmdzLlNFUklBTF9OVU1CRVIsIChzZXR0aW5nOiBTZXR0aW5nKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYXR0ci5TTiA9IHNldHRpbmcudmFsdWUudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgbG9nLmRlYnVnKCdTZW5zb3JMb2cuc2V0dGluZ0NoYW5nZWQ6IFNFUklBTF9OVU1CRVI9JyArIHRoaXMuYXR0ci5TTik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgbW9kZWwoY29uZmlnOiBVU0JDb25maWcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBjb25maWcubWFudWZhY3R1cmVyIHx8ICcnICsgY29uZmlnLnByb2R1Y3QgfHwgJ1RlbXBlciA4JztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBTTihjb25maWc6IFVTQkNvbmZpZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5zZXJpYWxOdW1iZXIgfHwgU2V0dGluZ3MuZ2V0KFNldHRpbmdzLlNFUklBTF9OVU1CRVIpLnZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vIFRyYWNrIHdoYXQgc2Vuc29yIHdlIHNob3VsZCByZXF1ZXN0IHZhbHVlIGZyb20gbmV4dCB0aW1lXHJcbiAgICBwcm90ZWN0ZWQgbmV4dFNlbnNvcjogbnVtYmVyID0gMDtcclxuXHJcbiAgICAvLyBJbnRlcmZhY2UgbWV0aG9kcyBpbXBsZW1lbnRhdGlvblxyXG5cclxuICAgIHB1YmxpYyBpbml0V3JpdGVSZXBvcnQoKTogbnVtYmVyW11bXSB7XHJcbiAgICAvLyBUaGlzIHN0YXJ0cyB0aGUgcG9sbGluZy4gRmlyc3Qgd2UgYXNrIHRoZSBkZXZpY2UgYWJvdXQgc2Vuc29ycyBhdHRhY2hlZCBjb25maWd1cmF0aW9uXHJcbiAgICAvLyBXZSBhbHNvIHJlcXVlc3QgdGVtcGVyYXR1cmUgZnJvbSBwb3J0IHplcm8gKGZvciB0aGUgc2FrZSBvZiBpdCwgdW5jbGVhciByZWFzb24pXHJcbiAgICAgICAgdGhpcy5uZXh0U2Vuc29yID0gMDtcclxuICAgICAgICByZXR1cm4gW3RoaXMudXNlZFBvcnRzUmVxdWVzdCgpLCB0aGlzLnRlbXBlcmF0dXJlUmVxdWVzdCh0aGlzLm5leHRTZW5zb3IpXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUaGlzIGZ1bmN0aW9uIHBhcnNlcyBhbGwgaW5wdXQgcmVwb3J0cyBhbmQgY2hlY2sgd2hhdCB0byBkb1xyXG4gICAgLy8gV2UgYXJlIGludGVyZXN0ZWQgaW4gdHdvIHR5cGVzIG9mIGRhdGEgZnJvbSB0aGUgZGV2aWNlOiB3aGljaCBwb3J0cyBhcmUgdXNlZCBhbmRcclxuICAgIC8vIHRoZSB0ZW1wZXJhdHVyZSBvZiB0aGUgc2Vuc29ycyBjb25uZWN0ZWQuXHJcbiAgICBwdWJsaWMgcmVhZFJlcG9ydChkYXRhOiBudW1iZXJbXSk6IG51bWJlcltdIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5tYXRjaFVzZWRQb3J0cyhkYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKCcrKysgVGVtcGVyOC5tYXRjaFVzZWRQb3J0czonLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gdGhpcy50ZW1wZXJhdHVyZVJlcXVlc3QodGhpcy5zZW5zb3JzW3RoaXMubmV4dFNlbnNvcl0ucy5nZXRQb3J0KCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0U2Vuc29yICs9IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWF0Y2hUZW1wZXJhdHVyZShkYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKCcrKysgVGVtcGVyOC5tYXRjaFRlbXBlcmF0dXJlOicsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubmV4dFNlbnNvciA8IHRoaXMuc2Vuc29ycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHRoaXMudGVtcGVyYXR1cmVSZXF1ZXN0KHRoaXMuc2Vuc29yc1t0aGlzLm5leHRTZW5zb3JdLnMuIGdldFBvcnQoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0U2Vuc29yICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0U2Vuc29yID0gMDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVjazAzUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWF0Y2hDaGVjazAzKGRhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVjazA1UmVxdWVzdCgpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1hdGNoQ2hlY2swNShkYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2swRFJlcXVlc3QoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1hdGNoQ2hlY2swRChkYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWF0Y2hDaGVja0ZGKGRhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoJyoqKiBUZW1wZXI4Lm1hdGNoQ2hlY2tGRjogcmVzdGFydD8nKTtcclxuICAgICAgICAgICAgICAgIC8vIFRoaXMgaW5kaWNhdGVzIGZhdWx0IGRldmljZVxyXG4gICAgICAgICAgICAgICAgLy8gRG9uJ3Qga25vdyB3aGV0aGVyIHRoZXJlIGlzIGEgd2F5IHRvIHJlY292ZXJcclxuICAgICAgICAgICAgICAgIC8vIE1heWJlIHJlc3RhcnRpbmcgdGhlIGRldmljZSBpcyBuZWNlc3NhcnkuXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignKioqIFRlbXBlcjgubWF0Y2hDaGVja0ZGJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGxvZy5lcnJvcihlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRlbXBlciA4IHNwZWNpZmljIG1ldGhvZHNcclxuICAgIC8vIFBvbGwgdXNlZCBwb3J0c1xyXG4gICAgcHJpdmF0ZSB1c2VkUG9ydHNSZXF1ZXN0KCk6IG51bWJlcltdIHtcclxuICAgICAgICByZXR1cm4gWzB4MDEsIDB4OEEsIDB4MDEsIDB4MDEsIDB4MDAsIDB4MDAsIDB4MDAsIDB4MDBdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VXNlZFBvcnRzKHRvdGFsOiBudW1iZXIsIHVzZWQ6IG51bWJlcik6IG51bWJlcltdIHtcclxuICAgICAgICBjb25zdCB1c2VkUG9ydHMgPSBuZXcgQXJyYXk8bnVtYmVyPih0b3RhbCk7XHJcbiAgICAgICAgY29uc3QgYml0czogbnVtYmVyW10gPSBbMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MF07XHJcblxyXG4gICAgICAgIGxldCBwb3J0SW5kZXggPSAwO1xyXG4gICAgICAgIC8vIENoZWNrIHRoZSBiaXQgYXJyYXkgZm9yIHVzZWQgcG9ydHMsIG9uZSBiaXQgYXQgYSB0aW1lXHJcbiAgICAgICAgZm9yIChsZXQgYml0ID0gMDsgYml0IDwgYml0cy5sZW5ndGg7IGJpdCsrKSB7XHJcbiAgICAgICAgICAgIGlmICgodXNlZCAmIGJpdHNbYml0XSkgPT09IGJpdHNbYml0XSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9ydCA9IGJpdDtcclxuICAgICAgICAgICAgICAgIHVzZWRQb3J0c1twb3J0SW5kZXhdID0gcG9ydDtcclxuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnKysrIFRlbXBlcjg6IFNlbnNvciBjb25uZWN0ZWQgdG8gcG9ydDogJyArIHBvcnQpO1xyXG4gICAgICAgICAgICAgICAgcG9ydEluZGV4ICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1c2VkUG9ydHM7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIG1hdGNoVXNlZFBvcnRzKGRhdGE6IG51bWJlcltdKTogYm9vbGVhbiB7XHJcbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBpbnB1dCByZXBvcnQgc3RhdGVzIHNlbnNvcnNcclxuICAgICAgICAvLyBjb25uZWN0ZWQgdG8gdGhlIHRoaXMuIFRoZXNlIGhleCB2YWx1ZXMgd2VyZSBmb3VuZCBieSB1c2luZyB1c2luZyBVU0JseXplclxyXG4gICAgICAgIC8vIEkuZS4gdGhleSBtaWdodCBiZSBkaWZmZXJlbnQgb24geW91ciBEZXZpY2UgZGV2aWNlXHJcblxyXG4gICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gOFxyXG4gICAgICAgICAgICAmJiBkYXRhWzBdID09PSAweDhBXHJcbiAgICAgICAgICAgICYmIGRhdGFbMV0gPT09IDB4MDhcclxuICAgICAgICAgICAgJiYgZGF0YVsyXSA9PT0gMHgwMVxyXG4gICAgICAgICAgICAmJiBkYXRhWzNdID09PSAweDAxKSB7XHJcblxyXG4gICAgICAgICAgICAvLyBCeXRlIDQgY29udGFpbnMgbm8gb2Ygc2Vuc29ycyBjb25uZWN0ZWQgdG8gVGVtcGVyOCBhbmRcclxuICAgICAgICAgICAgLy8gQnl0ZSA1IGNvbnRhaW5zIGEgYml0IGFycmF5IG9mIHBvcnRzIHVzZWQgYnkgdGhlIHNlbnNvcnNcclxuICAgICAgICAgICAgdGhpcy5jb25uZWN0U2Vuc29ycyh0aGlzLmdldFVzZWRQb3J0cyhkYXRhWzRdLCBkYXRhWzVdKSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBQb2xsIHRlbXBlcmF0dXJlIGFuZCB1cGRhdGUgc2Vuc29yIGRhdGFcclxuICAgIHByaXZhdGUgdGVtcGVyYXR1cmVSZXF1ZXN0KHBvcnQ6IG51bWJlcik6IG51bWJlcltdIHtcclxuICAgICAgICByZXR1cm4gWzB4MDEsIDB4ODAsIDB4MDEsIDB4MDAsIDB4MDAsIHBvcnQsIDB4MDAsIDB4MDBdO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSAgbWF0Y2hUZW1wZXJhdHVyZShkYXRhOiBudW1iZXJbXSkge1xyXG4gICAgICAgIC8vIGdldCB0aGUgdGVtcGVyYXR1cmUgYW5kIHVwZGF0ZSBzZW5zb3IgdmFsdWVcclxuXHJcbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBISUQgaW5wdXQgcmVwb3J0IGlzIGEgdGVtcGVyYXR1cmUgcmVwb3J0LFxyXG4gICAgICAgIC8vIFRoZXNlIGhleCB2YWx1ZXMgd2VyZSBmb3VuZCBieSBhbmFseXppbmcgVVNCIHVzaW5nIFVTQmx5emVyLlxyXG4gICAgICAgIC8vIEkuZS4gdGhleSBtaWdodCBiZSBkaWZmZXJlbnQgb24geW91ciBEZXZpY2UgZGV2aWNlXHJcbiAgICAgICAgLy8gYnl0ZSA0IGNvbnRhaW5zIHRoZSBwb3J0IG51bWJlci5cclxuICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDhcclxuICAgICAgICAgICAgJiYgZGF0YVswXSA9PT0gMHg4MFxyXG4gICAgICAgICAgICAmJiBkYXRhWzFdID09PSAweDA4XHJcbiAgICAgICAgICAgICYmIGRhdGFbMl0gPT09IDB4MDEpIHtcclxuICAgICAgICAgICAgbG9nLmRlYnVnKCcrKysgbWF0Y2hUZW1wZXJhdHVyZSwgZGF0YTogJWQnLCBkYXRhKTtcclxuICAgICAgICAgICAgY29uc3QgcG9ydDogbnVtYmVyID0gZGF0YVs0XTtcclxuICAgICAgICAgICAgY29uc3QgbXNiOiBudW1iZXIgPSBkYXRhWzVdO1xyXG4gICAgICAgICAgICBjb25zdCBsc2I6IG51bWJlciA9IGRhdGFbNl07XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXBlcmF0dXJlQ2Vsc2l1czogbnVtYmVyID0gdGhpcy5HZXRUZW1wZXJhdHVyZShtc2IsIGxzYik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbnNvcihwb3J0LCB0ZW1wZXJhdHVyZUNlbHNpdXMpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSAgR2V0VGVtcGVyYXR1cmUobXNiOiBudW1iZXIsIGxzYjogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICBsZXQgdGVtcGVyYXR1cmU6IG51bWJlciA9IDAuMDtcclxuXHJcbiAgICAgICAgbGV0IHJlYWRpbmc6IG51bWJlciA9IChsc2IgJiAweEZGKSArIChtc2IgPDwgOCk7XHJcblxyXG4gICAgICAgIC8vIEFzc3VtZSBwb3NpdGl2ZSB0ZW1wZXJhdHVyZSB2YWx1ZVxyXG4gICAgICAgIGxldCByZXN1bHQ6IG51bWJlciA9IDE7XHJcblxyXG4gICAgICAgIGlmICgocmVhZGluZyAmIDB4ODAwMCkgPiAwKSB7XHJcbiAgICAgICAgICAgIC8vIEJlbG93IHplcm9cclxuICAgICAgICAgICAgLy8gZ2V0IHRoZSBhYnNvbHV0ZSB2YWx1ZSBieSBjb252ZXJ0aW5nIHR3bydzIGNvbXBsZW1lbnRcclxuICAgICAgICAgICAgcmVhZGluZyA9IChyZWFkaW5nIF4gMHhmZmZmKSArIDE7XHJcblxyXG4gICAgICAgICAgICAvLyBSZW1lbWJlciBhIG5lZ2F0aXZlIHJlc3VsdFxyXG4gICAgICAgICAgICByZXN1bHQgPSAtMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFRoZSBlYXN0IHNpZ25pZmljYW50IGJpdCBpcyAyXi00IHNvIHdlIG5lZWQgdG8gZGl2aWRlIGJ5IDE2IHRvIGdldCBhYnNvbHV0ZSB0ZW1wZXJhdHVyZSBpbiBDZWxzaXVzXHJcbiAgICAgICAgLy8gTXVsdGlwbHkgaW4gdGhlIHJlc3VsdCB0byBnZXQgd2hldGhlciB0aGUgdGVtcGVyYXR1cmUgaXMgYmVsb3cgemVybyBkZWdyZWVzIGFuZCBjb252ZXJ0IHRvXHJcbiAgICAgICAgLy8gZmxvYXRpbmcgcG9pbnRcclxuICAgICAgICB0ZW1wZXJhdHVyZSA9IHJlc3VsdCAqIHJlYWRpbmcgLyAxNi4wO1xyXG5cclxuICAgICAgICByZXR1cm4gdGVtcGVyYXR1cmU7XHJcbiAgICB9XHJcbiAgICAvLyBQb2xsIGNoZWNrc1xyXG4gICAgcHJpdmF0ZSAgY2hlY2swM1JlcXVlc3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIFsweDAxLCAweDhBLCAweDAxLCAweDAzLCAweDAwLCAweDAwLCAweDAwLCAweDAwXTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgIG1hdGNoQ2hlY2swMyhkYXRhOiBudW1iZXJbXSkge1xyXG4gICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gOFxyXG4gICAgICAgICAgICAmJiBkYXRhWzBdID09PSAweDhBXHJcbiAgICAgICAgICAgICYmIGRhdGFbMV0gPT09IDB4MDhcclxuICAgICAgICAgICAgJiYgZGF0YVsyXSA9PT0gMHgwMVxyXG4gICAgICAgICAgICAmJiBkYXRhWzNdID09PSAweDAzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGNoZWNrMDVSZXF1ZXN0KCkge1xyXG4gICAgICAgIHJldHVybiBbMHgwMSwgMHg4QSwgMHgwMSwgMHgwNSwgMHgwMCwgMHgwMCwgMHgwMCwgMHgwMF07XHJcbiAgICB9XHJcbiAgICBwcml2YXRlICBtYXRjaENoZWNrMDUoZGF0YTogbnVtYmVyW10pIHtcclxuICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDhcclxuICAgICAgICAgICAgJiYgZGF0YVswXSA9PT0gMHg4QVxyXG4gICAgICAgICAgICAmJiBkYXRhWzFdID09PSAweDA4XHJcbiAgICAgICAgICAgICYmIGRhdGFbMl0gPT09IDB4MDFcclxuICAgICAgICAgICAgJiYgZGF0YVszXSA9PT0gMHgwNSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSAgY2hlY2swRFJlcXVlc3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIFsweDAxLCAweDhBLCAweDAxLCAweDBELCAweDAwLCAweDAwLCAweDAwLCAweDAwXTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgIG1hdGNoQ2hlY2swRChkYXRhOiBudW1iZXJbXSkge1xyXG4gICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gOFxyXG4gICAgICAgICAgICAmJiBkYXRhWzBdID09PSAweDhBXHJcbiAgICAgICAgICAgICYmIGRhdGFbMV0gPT09IDB4MDhcclxuICAgICAgICAgICAgJiYgZGF0YVsyXSA9PT0gMHgwMVxyXG4gICAgICAgICAgICAmJiBkYXRhWzNdID09PSAweDBEKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBwcml2YXRlICBjaGVja0ZGUmVxdWVzdCgpIHtcclxuICAgIC8vICAgICByZXR1cm4gWzB4RkYsIDB4RkYsIDB4RkYsIDB4RkYsIDB4RkYsIDB4RkYsIDB4RkYsIDB4RkZdO1xyXG4gICAgLy8gfVxyXG4gICAgcHJpdmF0ZSAgbWF0Y2hDaGVja0ZGKGRhdGE6IG51bWJlcltdKSB7XHJcbiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSA4XHJcbiAgICAgICAgICAgICYmIGRhdGFbMF0gPT09IDB4RkZcclxuICAgICAgICAgICAgJiYgZGF0YVsxXSA9PT0gMHhGRlxyXG4gICAgICAgICAgICAmJiBkYXRhWzJdID09PSAweEZGXHJcbiAgICAgICAgICAgICYmIGRhdGFbM10gPT09IDB4RkYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuIl19
