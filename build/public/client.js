var sensors = [];
var settings = [];
var currentSection;
openSensorSection();
var url = 'ws://' + document.domain;
var socket = new WebSocket(url);
socket.onopen = function (e) {
    setConnectionStatus(true);
    socket.send(JSON.stringify({ descr: 'getSensors' }));
    socket.send(JSON.stringify({ descr: 'getSettings' }));
};
socket.onmessage = function (event) {
    setConnectionStatus(true);
    var msg = JSON.parse(event.data);
    switch (msg.descr) {
        case 'sensors':
            listSensors(msg.data);
            if (!isMonitoring) {
                startMonitor(sensors);
            }
            break;
        case 'settings':
            listSettings(msg.data);
            break;
        case 'log':
            log(msg.data);
            break;
    }
};
socket.onclose = function (event) {
    setConnectionStatus(false);
    clearTimeout(logTimer);
    logTimer = setInterval(clearSensorValue, 5000);
};
socket.onerror = function (error) {
    setConnectionStatus(false);
    clearTimeout(logTimer);
    logTimer = setInterval(clearSensorValue, 5000);
};
function openSection(name) {
    var section = document.getElementById(name);
    if (currentSection) {
        currentSection.style.display = 'none';
    }
    section.style.display = 'block';
    currentSection = section;
}
function openSensorSection() {
    openSection('sensorSection');
}
function openSettingsSection() {
    openSection('settingsSection');
}
function sensorName(descr) {
    return descr.SN + ', port ' + descr.port;
}
function sensorId(descr) {
    var sn = descr.SN.replace(' ', descr.SN);
    var id = descr.SN.replace(' ', descr.SN) + '-' + descr.port;
    return id;
}
function listSensors(sensors) {
    var section = document.getElementById('sensorSection');
    for (var _i = 0, sensors_1 = sensors; _i < sensors_1.length; _i++) {
        var sensor = sensors_1[_i];
        var article = document.createElement('article');
        var heading = document.createElement('h3');
        heading.id = sensorId(sensor.descr) + '-value';
        article.appendChild(heading);
        var descr = document.createElement('p');
        descr.id = sensorId(sensor.descr);
        article.appendChild(descr);
        section.appendChild(article);
    }
    log(sensors);
}
var isMonitoring = false;
function setMonitoringButton() {
    var button = document.getElementById('monitor');
    if (isMonitoring) {
        button.innerHTML = 'Stop monitor';
    }
    else {
        button.innerHTML = 'Start Monitor';
    }
}
function startMonitor(sensors) {
    isMonitoring = true;
    setMonitoringButton();
    var descr = 'startMonitor';
    var data = [];
    for (var _i = 0, sensors_2 = sensors; _i < sensors_2.length; _i++) {
        var sensor = sensors_2[_i];
        data.push(sensor.descr);
    }
    socket.send(JSON.stringify({ descr: descr, data: data }));
}
function stopMonitor(sensors) {
    isMonitoring = false;
    setMonitoringButton();
    var descr = 'stopMonitor';
    var data = [];
    for (var _i = 0, sensors_3 = sensors; _i < sensors_3.length; _i++) {
        var sensor = sensors_3[_i];
        data.push(sensor.descr);
    }
    socket.send(JSON.stringify({ descr: descr, data: data }));
}
var logTimer;
function log(sensorData) {
    for (var _i = 0, sensorData_1 = sensorData; _i < sensorData_1.length; _i++) {
        var sensor = sensorData_1[_i];
        var log_1 = document.getElementById(sensorId(sensor.descr) + '-value');
        if (log_1) {
            var date = new Date(sensor.samples[0].date);
            var value = sensor.samples[0].value;
            log_1.innerHTML = value + ' Â°C';
        }
        var descr = document.getElementById(sensorId(sensor.descr));
        if (descr) {
            var date = new Date(sensor.samples[0].date);
            var value = sensor.samples[0].value;
            descr.innerHTML = 'by ' + sensorName(sensor.descr) + ': ' +
                date.toLocaleDateString() + ', ' + date.toLocaleTimeString();
        }
        clearTimeout(logTimer);
        logTimer = setInterval(clearSensorValue, 5000);
    }
}
function listSettings(allSettings) {
    var section = document.getElementById('settingsSection');
    for (var _i = 0, allSettings_1 = allSettings; _i < allSettings_1.length; _i++) {
        var setting = allSettings_1[_i];
        var article = document.createElement('article');
        var heading = document.createElement('h3');
        heading.id = setting.name;
        heading.innerHTML = setting.name;
        article.appendChild(heading);
        var value = document.createElement('p');
        value.id = setting.name + '-value';
        value.innerHTML = setting.value;
        article.appendChild(value);
        section.appendChild(article);
    }
}
function setConnectionStatus(connected) {
    var status = document.getElementById('connection');
    isMonitoring = connected && isMonitoring;
    setMonitoringButton();
    if (connected && isMonitoring) {
        status.innerHTML = ' (live)';
    }
    else if (connected) {
        status.innerHTML = ' (Connected)';
    }
    else {
        status.innerHTML = ' (Disconnected)';
    }
}
function monitor() {
    if (isMonitoring) {
        stopMonitor(sensors);
    }
    else {
        startMonitor(sensors);
    }
}
function clearSensorValue() {
    for (var _i = 0, sensors_4 = sensors; _i < sensors_4.length; _i++) {
        var sensor = sensors_4[_i];
        var sampleDate = sensor.samples[0].date;
        if (Date.now() - sampleDate > 60000) {
            var sensorValue = document.getElementById(sensorId(sensor));
            sensorValue.innerHTML = 'No sensor data received last 60 seconds';
        }
    }
    setConnectionStatus(socket.readyState === socket.OPEN);
    if (socket.readyState === socket.CLOSED) {
        socket = new WebSocket(url);
    }
}
function round(value, precision) {
    //    precision || (precision = 1);
    var inverse = 1.0 / precision;
    return Math.round(value * inverse) / inverse;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9icm93c2VyL2NsaWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDakIsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO0FBQ2xCLElBQUksY0FBMkIsQ0FBQztBQUdoQyxpQkFBaUIsRUFBRSxDQUFDO0FBRXBCLElBQU0sR0FBRyxHQUFHLE9BQU8sR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO0FBQ3RDLElBQUksTUFBTSxHQUFHLElBQUksU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2hDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsVUFBUyxDQUFDO0lBQ3RCLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzFCLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFDLEtBQUssRUFBRSxZQUFZLEVBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUMsS0FBSyxFQUFFLGFBQWEsRUFBQyxDQUFDLENBQUMsQ0FBQztBQUN4RCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsU0FBUyxHQUFHLFVBQVMsS0FBSztJQUM3QixtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMxQixJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQyxRQUFPLEdBQUcsQ0FBQyxLQUFLLEVBQUU7UUFDZCxLQUFLLFNBQVM7WUFDVixXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxZQUFZLEVBQUU7Z0JBQ2YsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3pCO1lBQ0QsTUFBTTtRQUNWLEtBQUssVUFBVTtZQUNYLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkIsTUFB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LE1BQU0sQ0FBQyxTQUFTLEdBQUcsaUJBQWlCLENBQUM7S0FDeEM7QUFDTCxDQUFDO0FBSUQ7SUFDSSxJQUFJLFlBQVksRUFBRTtRQUNkLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztLQUV4QjtTQUFNO1FBQ0gsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQ3pCO0FBQ0wsQ0FBQztBQUVEO0lBQ0ksS0FBcUIsVUFBTyxFQUFQLG1CQUFPLEVBQVAscUJBQU8sRUFBUCxJQUFPLEVBQUU7UUFBekIsSUFBTSxNQUFNLGdCQUFBO1FBQ2IsSUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDMUMsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsVUFBVSxHQUFHLEtBQU0sRUFBRTtZQUNsQyxJQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQzlELFdBQVcsQ0FBQyxTQUFTLEdBQUcseUNBQXlDLENBQUM7U0FDckU7S0FDSjtJQUVELG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxVQUFVLEtBQUssTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZELElBQUksTUFBTSxDQUFDLFVBQVUsS0FBSyxNQUFNLENBQUMsTUFBTSxFQUFFO1FBQ3JDLE1BQU0sR0FBRyxJQUFJLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUMvQjtBQUNMLENBQUM7QUFFRCxlQUFlLEtBQUssRUFBRSxTQUFTO0lBQzNCLG1DQUFtQztJQUNuQyxJQUFNLE9BQU8sR0FBRyxHQUFHLEdBQUcsU0FBUyxDQUFDO0lBQ2hDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEdBQUcsT0FBTyxDQUFDO0FBQ2pELENBQUMiLCJmaWxlIjoiY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHNlbnNvcnMgPSBbXTtcclxubGV0IHNldHRpbmdzID0gW107XHJcbmxldCBjdXJyZW50U2VjdGlvbjogSFRNTEVsZW1lbnQ7XHJcblxyXG5cclxub3BlblNlbnNvclNlY3Rpb24oKTtcclxuXHJcbmNvbnN0IHVybCA9ICd3czovLycgKyBkb2N1bWVudC5kb21haW47XHJcbmxldCBzb2NrZXQgPSBuZXcgV2ViU29ja2V0KHVybCk7XHJcbnNvY2tldC5vbm9wZW4gPSBmdW5jdGlvbihlKSB7XHJcbiAgICBzZXRDb25uZWN0aW9uU3RhdHVzKHRydWUpO1xyXG4gICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoe2Rlc2NyOiAnZ2V0U2Vuc29ycyd9KSk7XHJcbiAgICBzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7ZGVzY3I6ICdnZXRTZXR0aW5ncyd9KSk7XHJcbn07XHJcblxyXG5zb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgIHNldENvbm5lY3Rpb25TdGF0dXModHJ1ZSk7XHJcbiAgICBjb25zdCBtc2cgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xyXG4gICAgc3dpdGNoKG1zZy5kZXNjcikge1xyXG4gICAgICAgIGNhc2UgJ3NlbnNvcnMnOlxyXG4gICAgICAgICAgICBsaXN0U2Vuc29ycyhtc2cuZGF0YSk7XHJcbiAgICAgICAgICAgIGlmICghaXNNb25pdG9yaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBzdGFydE1vbml0b3Ioc2Vuc29ycyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnc2V0dGluZ3MnOlxyXG4gICAgICAgICAgICBsaXN0U2V0dGluZ3MobXNnLmRhdGEpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdsb2cnOlxyXG4gICAgICAgICAgICBsb2cobXNnLmRhdGEpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG59O1xyXG5cclxuc29ja2V0Lm9uY2xvc2UgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgc2V0Q29ubmVjdGlvblN0YXR1cyhmYWxzZSk7XHJcbiAgICBjbGVhclRpbWVvdXQobG9nVGltZXIpO1xyXG4gICAgbG9nVGltZXIgPSBzZXRJbnRlcnZhbChjbGVhclNlbnNvclZhbHVlLCA1MDAwKTtcclxufTtcclxuXHJcbnNvY2tldC5vbmVycm9yID0gZnVuY3Rpb24oZXJyb3IpIHtcclxuICAgIHNldENvbm5lY3Rpb25TdGF0dXMoZmFsc2UpO1xyXG4gICAgY2xlYXJUaW1lb3V0KGxvZ1RpbWVyKTtcclxuICAgIGxvZ1RpbWVyID0gc2V0SW50ZXJ2YWwoY2xlYXJTZW5zb3JWYWx1ZSwgNTAwMCk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBvcGVuU2VjdGlvbihuYW1lOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHNlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChuYW1lKTtcclxuICAgIGlmIChjdXJyZW50U2VjdGlvbikge1xyXG4gICAgICAgIGN1cnJlbnRTZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICB9XHJcbiAgICBzZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgY3VycmVudFNlY3Rpb24gPSBzZWN0aW9uO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvcGVuU2Vuc29yU2VjdGlvbigpIHtcclxuICAgIG9wZW5TZWN0aW9uKCdzZW5zb3JTZWN0aW9uJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9wZW5TZXR0aW5nc1NlY3Rpb24oKSB7XHJcbiAgICBvcGVuU2VjdGlvbignc2V0dGluZ3NTZWN0aW9uJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNlbnNvck5hbWUoZGVzY3IpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGRlc2NyLlNOICsgJywgcG9ydCAnICsgZGVzY3IucG9ydDtcclxufVxyXG5cclxuZnVuY3Rpb24gc2Vuc29ySWQoZGVzY3IpOiBzdHJpbmcge1xyXG4gICAgY29uc3Qgc24gPSBkZXNjci5TTi5yZXBsYWNlKCcgJywgZGVzY3IuU04pO1xyXG4gICAgY29uc3QgaWQgPSBkZXNjci5TTi5yZXBsYWNlKCcgJywgZGVzY3IuU04pICsgJy0nICsgZGVzY3IucG9ydDtcclxuICAgIHJldHVybiBpZDtcclxufVxyXG5cclxuZnVuY3Rpb24gbGlzdFNlbnNvcnMoc2Vuc29ycykge1xyXG4gICAgY29uc3Qgc2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZW5zb3JTZWN0aW9uJyk7XHJcbiAgICBmb3IgKGNvbnN0IHNlbnNvciBvZiBzZW5zb3JzKSB7XHJcbiAgICAgICAgY29uc3QgYXJ0aWNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2FydGljbGUnKTtcclxuICAgICAgICBjb25zdCBoZWFkaW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcclxuXHJcbiAgICAgICAgaGVhZGluZy5pZCA9IHNlbnNvcklkKHNlbnNvci5kZXNjcikgKyAnLXZhbHVlJztcclxuICAgICAgICBhcnRpY2xlLmFwcGVuZENoaWxkKGhlYWRpbmcpO1xyXG5cclxuICAgICAgICBjb25zdCBkZXNjciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgICAgICBkZXNjci5pZCA9IHNlbnNvcklkKHNlbnNvci5kZXNjcik7XHJcbiAgICAgICAgYXJ0aWNsZS5hcHBlbmRDaGlsZChkZXNjcik7XHJcbiAgICAgICAgc2VjdGlvbi5hcHBlbmRDaGlsZChhcnRpY2xlKTtcclxuICAgIH1cclxuICAgIGxvZyhzZW5zb3JzKTtcclxufVxyXG5sZXQgaXNNb25pdG9yaW5nID0gZmFsc2U7XHJcbmZ1bmN0aW9uIHNldE1vbml0b3JpbmdCdXR0b24oKSB7XHJcbiAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9uaXRvcicpO1xyXG4gICAgaWYgKGlzTW9uaXRvcmluZykge1xyXG4gICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSAnU3RvcCBtb25pdG9yJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9ICdTdGFydCBNb25pdG9yJztcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc3RhcnRNb25pdG9yKHNlbnNvcnMpIHtcclxuICAgIGlzTW9uaXRvcmluZyA9IHRydWU7XHJcbiAgICBzZXRNb25pdG9yaW5nQnV0dG9uKCk7XHJcbiAgICBjb25zdCBkZXNjciA9ICdzdGFydE1vbml0b3InO1xyXG4gICAgY29uc3QgZGF0YTogYW55ID0gW107XHJcbiAgICBmb3IgKGNvbnN0IHNlbnNvciBvZiBzZW5zb3JzKSB7XHJcbiAgICAgICAgZGF0YS5wdXNoKHNlbnNvci5kZXNjcik7XHJcbiAgICB9XHJcbiAgICBzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7ZGVzY3IsIGRhdGF9KSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0b3BNb25pdG9yKHNlbnNvcnMpIHtcclxuICAgIGlzTW9uaXRvcmluZyA9IGZhbHNlO1xyXG4gICAgc2V0TW9uaXRvcmluZ0J1dHRvbigpO1xyXG4gICAgY29uc3QgZGVzY3IgPSAnc3RvcE1vbml0b3InO1xyXG4gICAgY29uc3QgZGF0YTogYW55ID0gW107XHJcbiAgICBmb3IgKGNvbnN0IHNlbnNvciBvZiBzZW5zb3JzKSB7XHJcbiAgICAgICAgZGF0YS5wdXNoKHNlbnNvci5kZXNjcik7XHJcbiAgICB9XHJcbiAgICBzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7ZGVzY3IsIGRhdGF9KSk7XHJcbn1cclxubGV0IGxvZ1RpbWVyO1xyXG5mdW5jdGlvbiBsb2coc2Vuc29yRGF0YSkge1xyXG4gICAgZm9yIChjb25zdCBzZW5zb3Igb2Ygc2Vuc29yRGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbnNvcklkKHNlbnNvci5kZXNjcikgKyAnLXZhbHVlJyk7XHJcbiAgICAgICAgaWYgKGxvZykge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoc2Vuc29yLnNhbXBsZXNbMF0uZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc2Vuc29yLnNhbXBsZXNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgIGxvZy5pbm5lckhUTUwgPSB2YWx1ZSArICcgwrBDJztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZGVzY3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZW5zb3JJZChzZW5zb3IuZGVzY3IpKTtcclxuICAgICAgICBpZiAoZGVzY3IpIHtcclxuICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHNlbnNvci5zYW1wbGVzWzBdLmRhdGUpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHNlbnNvci5zYW1wbGVzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICBkZXNjci5pbm5lckhUTUwgPSAnYnkgJyArIHNlbnNvck5hbWUoc2Vuc29yLmRlc2NyKSAgKyAnOiAnICtcclxuICAgICAgICAgICAgICAgIGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCkgKyAnLCAnICsgZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KGxvZ1RpbWVyKTtcclxuICAgICAgICBsb2dUaW1lciA9IHNldEludGVydmFsKGNsZWFyU2Vuc29yVmFsdWUsIDUwMDApO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIGxpc3RTZXR0aW5ncyhhbGxTZXR0aW5ncykge1xyXG4gICAgY29uc3Qgc2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXR0aW5nc1NlY3Rpb24nKTtcclxuICAgIGZvciAoY29uc3Qgc2V0dGluZyBvZiBhbGxTZXR0aW5ncykge1xyXG4gICAgICAgIGNvbnN0IGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhcnRpY2xlJyk7XHJcbiAgICAgICAgY29uc3QgaGVhZGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XHJcblxyXG4gICAgICAgIGhlYWRpbmcuaWQgPSBzZXR0aW5nLm5hbWU7XHJcbiAgICAgICAgaGVhZGluZy5pbm5lckhUTUwgPSBzZXR0aW5nLm5hbWU7XHJcbiAgICAgICAgYXJ0aWNsZS5hcHBlbmRDaGlsZChoZWFkaW5nKTtcclxuXHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgICAgICAgdmFsdWUuaWQgPSBzZXR0aW5nLm5hbWUgKyAnLXZhbHVlJztcclxuICAgICAgICB2YWx1ZS5pbm5lckhUTUwgPSBzZXR0aW5nLnZhbHVlO1xyXG4gICAgICAgIGFydGljbGUuYXBwZW5kQ2hpbGQodmFsdWUpO1xyXG4gICAgICAgIHNlY3Rpb24uYXBwZW5kQ2hpbGQoYXJ0aWNsZSk7XHJcbiAgICB9XHJcblxyXG59XHJcbmZ1bmN0aW9uIHNldENvbm5lY3Rpb25TdGF0dXMoY29ubmVjdGVkOiBib29sZWFuKSB7XHJcbiAgICBjb25zdCBzdGF0dXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29ubmVjdGlvbicpO1xyXG4gICAgaXNNb25pdG9yaW5nID0gY29ubmVjdGVkICYmIGlzTW9uaXRvcmluZztcclxuICAgIHNldE1vbml0b3JpbmdCdXR0b24oKTtcclxuICAgIGlmIChjb25uZWN0ZWQgJiYgaXNNb25pdG9yaW5nKSB7XHJcbiAgICAgICAgc3RhdHVzLmlubmVySFRNTCA9ICcgKGxpdmUpJztcclxuICAgIH0gZWxzZSBpZiAoY29ubmVjdGVkKSB7XHJcbiAgICAgICAgc3RhdHVzLmlubmVySFRNTCA9ICcgKENvbm5lY3RlZCknO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBzdGF0dXMuaW5uZXJIVE1MID0gJyAoRGlzY29ubmVjdGVkKSc7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gbW9uaXRvcigpIHtcclxuICAgIGlmIChpc01vbml0b3JpbmcpIHtcclxuICAgICAgICBzdG9wTW9uaXRvcihzZW5zb3JzKTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHN0YXJ0TW9uaXRvcihzZW5zb3JzKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2xlYXJTZW5zb3JWYWx1ZSgpIHtcclxuICAgIGZvciAoY29uc3Qgc2Vuc29yIG9mIHNlbnNvcnMpIHtcclxuICAgICAgICBjb25zdCBzYW1wbGVEYXRlID0gc2Vuc29yLnNhbXBsZXNbMF0uZGF0ZTtcclxuICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIHNhbXBsZURhdGUgPiA2MF8wMDApIHtcclxuICAgICAgICAgICAgY29uc3Qgc2Vuc29yVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZW5zb3JJZChzZW5zb3IpKTtcclxuICAgICAgICAgICAgc2Vuc29yVmFsdWUuaW5uZXJIVE1MID0gJ05vIHNlbnNvciBkYXRhIHJlY2VpdmVkIGxhc3QgNjAgc2Vjb25kcyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldENvbm5lY3Rpb25TdGF0dXMoc29ja2V0LnJlYWR5U3RhdGUgPT09IHNvY2tldC5PUEVOKTtcclxuICAgIGlmIChzb2NrZXQucmVhZHlTdGF0ZSA9PT0gc29ja2V0LkNMT1NFRCkge1xyXG4gICAgICAgIHNvY2tldCA9IG5ldyBXZWJTb2NrZXQodXJsKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcm91bmQodmFsdWUsIHByZWNpc2lvbikge1xyXG4gICAgLy8gICAgcHJlY2lzaW9uIHx8IChwcmVjaXNpb24gPSAxKTtcclxuICAgIGNvbnN0IGludmVyc2UgPSAxLjAgLyBwcmVjaXNpb247XHJcbiAgICByZXR1cm4gTWF0aC5yb3VuZCh2YWx1ZSAqIGludmVyc2UpIC8gaW52ZXJzZTtcclxufVxyXG4iXX0=
