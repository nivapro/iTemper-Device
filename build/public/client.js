var sensors = [{ descr: { SN: 'Temper 8', port: 0 }, samples: [{ value: 25.5, date: Date.now() }] },
    { descr: { SN: 'Temper 8', port: 1 }, samples: [{ value: 18.2, date: Date.now() + 5056 }] },
    { descr: { SN: 'Temper Gold', port: 0 }, samples: [{ value: 25.5, date: Date.now() + 4088 }] }];
function setPage(name) {
    var page = document.getElementById('page');
    page.innerHTML = name;
}
setPage('Sensors');
function sensorName(descr) {
    return descr.SN + ', port: ' + descr.port;
}
function sensorId(descr) {
    var sn = descr.SN.replace(' ', descr.SN);
    console.log(sn);
    var id = descr.SN.replace(' ', descr.SN) + '-' + descr.port;
    return id;
}
function listSensors(sensors) {
    for (var _i = 0, sensors_1 = sensors; _i < sensors_1.length; _i++) {
        var sensor = sensors_1[_i];
        var article = document.createElement('article');
        var title = document.createElement('h3');
        title.innerHTML = sensorName(sensor.descr);
        article.appendChild(title);
        var sensorValue = document.createElement('div');
        sensorValue.innerHTML = 'No sensor data';
        sensorValue.id = sensorId(sensor.descr);
        article.appendChild(sensorValue);
        var section = document.getElementById('app');
        section.appendChild(article);
    }
    log(sensors);
}
var isMonitoring = false;
function setMonitoringButton() {
    var button = document.getElementById('monitor');
    if (isMonitoring) {
        button.innerHTML = 'Stop';
    }
    else {
        button.innerHTML = 'Monitor';
    }
}
function startMonitor(sensors) {
    var descr = 'startMonitor';
    var data = [];
    for (var _i = 0, sensors_2 = sensors; _i < sensors_2.length; _i++) {
        var sensor = sensors_2[_i];
        data.push(sensor.descr);
    }
    socket.send(JSON.stringify({ descr: descr, data: data }));
}
function stopMonitor(sensors) {
    isMonitoring = false;
    setMonitoringButton();
    var descr = 'stopMonitor';
    var data = [];
    for (var _i = 0, sensors_3 = sensors; _i < sensors_3.length; _i++) {
        var sensor = sensors_3[_i];
        data.push(sensor.descr);
    }
    socket.send(JSON.stringify({ descr: descr, data: data }));
}
var logTimer;
function log(sensorData) {
    isMonitoring = true;
    setMonitoringButton();
    for (var _i = 0, sensorData_1 = sensorData; _i < sensorData_1.length; _i++) {
        var sensor = sensorData_1[_i];
        var log_1 = document.getElementById(sensorId(sensor.descr));
        if (log_1) {
            var date = new Date(sensor.samples[0].date);
            var value = sensor.samples[0].value;
            log_1.innerHTML = value + ' Â°C, from: ' +
                date.toLocaleDateString() + ', ' + date.toLocaleTimeString();
        }
    }
    clearTimeout(logTimer);
    logTimer = setInterval(clearSensorValue, 5000);
}
function settings(allSettings) {
    // TODO
}
function setConnectionStatus(connected) {
    if (connected) {
        var status_1 = document.getElementById('connection');
        status_1.innerHTML = ' (live)';
    }
    else {
        var status_2 = document.getElementById('connection');
        status_2.innerHTML = ' (Disconnected)';
    }
}
var url = 'ws://precision.vading.lan';
var socket = new WebSocket(url);
socket.onopen = function (e) {
    setConnectionStatus(true);
    socket.send(JSON.stringify({ descr: 'getSensors' }));
    socket.send(JSON.stringify({ descr: 'getSettings' }));
};
socket.onmessage = function (event) {
    setConnectionStatus(true);
    var msg = JSON.parse(event.data);
    switch (msg.descr) {
        case 'sensors':
            listSensors(msg.data);
            if (!isMonitoring) {
                startMonitor(sensors);
            }
            break;
        case 'settings':
            settings(msg.data);
            break;
        case 'log':
            log(msg.data);
            break;
    }
};
socket.onclose = function (event) {
    setConnectionStatus(false);
    if (event.wasClean) {
        alert("[close] Connection closed cleanly, code=" + event.code + " reason=" + event.reason);
    }
    else {
        // e.g. server process killed or network down
        // event.code is usually 1006 in this case
        alert('[close] Connection died');
    }
};
socket.onerror = function (error) {
    setConnectionStatus(false);
    // alert(`[error] ${error.message}`);
};
function simulateMonitoring(sensors) {
    for (var _i = 0, sensors_4 = sensors; _i < sensors_4.length; _i++) {
        var sensor = sensors_4[_i];
        // simulate timestamp
        var date = new Date(Date.now() - Math.floor(Math.random() * 15000));
        sensor.samples[0].date = date.getMilliseconds();
        // simulate new sensor reading
        var value = sensor.samples[0].value + 5 * Math.random();
        sensor.samples[0].value = value;
    }
}
function monitor() {
    if (isMonitoring) {
        stopMonitor(sensors);
    }
    else {
        startMonitor(sensors);
    }
}
function clearSensorValue() {
    for (var _i = 0, sensors_5 = sensors; _i < sensors_5.length; _i++) {
        var sensor = sensors_5[_i];
        var sampleDate = sensor.samples[0].date;
        if (Date.now() - sampleDate > 7 * 24 * 3600000) {
            var sensorValue = document.getElementById(sensorId(sensor));
            sensorValue.innerHTML = 'No sensor data received last 15 seconds';
        }
    }
    setConnectionStatus(socket.readyState === socket.OPEN);
    if (socket.readyState === socket.CLOSED) {
        socket = new WebSocket(url);
    }
}
function round(value, precision) {
    //    precision || (precision = 1);
    var inverse = 1.0 / precision;
    return Math.round(value * inverse) / inverse;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9icm93c2VyL2NsaWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLE9BQU8sR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFO0lBQ25HLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxFQUFFLENBQUMsRUFBRTtJQUMzRixFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBRWhHLGlCQUFpQixJQUFJO0lBQ2pCLElBQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDN0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7QUFDMUIsQ0FBQztBQUVELE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUVuQixvQkFBb0IsS0FBSztJQUNyQixPQUFPLEtBQUssQ0FBQyxFQUFFLEdBQUcsVUFBVSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7QUFDOUMsQ0FBQztBQUVELGtCQUFrQixLQUFLO0lBQ25CLElBQU0sRUFBRSxHQUFHLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxD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TUFBTSxnQkFBQTtRQUNiLElBQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzFDLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLFVBQVUsR0FBRyxDQUFDLEdBQUMsRUFBRSxHQUFDLE9BQVEsRUFBRTtZQUN6QyxJQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQzlELFdBQVcsQ0FBQyxTQUFTLEdBQUcseUNBQXlDLENBQUM7U0FDckU7S0FDSjtJQUVELG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxVQUFVLEtBQUssTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZELElBQUksTUFBTSxDQUFDLFVBQVUsS0FBSyxNQUFNLENBQUMsTUFBTSxFQUFFO1FBQ3JDLE1BQU0sR0FBRyxJQUFJLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUMvQjtBQUNMLENBQUM7QUFFRCxlQUFlLEtBQUssRUFBRSxTQUFTO0lBQzNCLG1DQUFtQztJQUNuQyxJQUFNLE9BQU8sR0FBRyxHQUFHLEdBQUcsU0FBUyxDQUFDO0lBQ2hDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEdBQUcsT0FBTyxDQUFDO0FBQ2pELENBQUMiLCJmaWxlIjoiY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHNlbnNvcnMgPSBbeyBkZXNjcjogeyBTTjogJ1RlbXBlciA4JywgcG9ydDogMCB9LCBzYW1wbGVzOiBbeyB2YWx1ZTogMjUuNSwgZGF0ZTogRGF0ZS5ub3coKSB9XSB9LFxyXG57IGRlc2NyOiB7IFNOOiAnVGVtcGVyIDgnLCBwb3J0OiAxIH0sIHNhbXBsZXM6IFt7IHZhbHVlOiAxOC4yLCBkYXRlOiBEYXRlLm5vdygpICsgNTA1NiB9XSB9LFxyXG57IGRlc2NyOiB7IFNOOiAnVGVtcGVyIEdvbGQnLCBwb3J0OiAwIH0sIHNhbXBsZXM6IFt7IHZhbHVlOiAyNS41LCBkYXRlOiBEYXRlLm5vdygpICsgNDA4OCB9XSB9XTtcclxuXHJcbmZ1bmN0aW9uIHNldFBhZ2UobmFtZSkge1xyXG4gICAgY29uc3QgcGFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlJyk7XHJcbiAgICBwYWdlLmlubmVySFRNTCA9IG5hbWU7XHJcbn1cclxuXHJcbnNldFBhZ2UoJ1NlbnNvcnMnKTtcclxuXHJcbmZ1bmN0aW9uIHNlbnNvck5hbWUoZGVzY3IpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGRlc2NyLlNOICsgJywgcG9ydDogJyArIGRlc2NyLnBvcnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNlbnNvcklkKGRlc2NyKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHNuID0gZGVzY3IuU04ucmVwbGFjZSgnICcsIGRlc2NyLlNOKTtcclxuICAgIGNvbnNvbGUubG9nKHNuKTtcclxuICAgIGNvbnN0IGlkID0gZGVzY3IuU04ucmVwbGFjZSgnICcsIGRlc2NyLlNOKSArICctJyArIGRlc2NyLnBvcnQ7XHJcbiAgICByZXR1cm4gaWQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxpc3RTZW5zb3JzKHNlbnNvcnMpIHtcclxuICAgIGZvciAoY29uc3Qgc2Vuc29yIG9mIHNlbnNvcnMpIHtcclxuICAgICAgICBjb25zdCBhcnRpY2xlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYXJ0aWNsZScpO1xyXG5cclxuICAgICAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XHJcbiAgICAgICAgdGl0bGUuaW5uZXJIVE1MID0gc2Vuc29yTmFtZShzZW5zb3IuZGVzY3IpO1xyXG4gICAgICAgIGFydGljbGUuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG5cclxuICAgICAgICBjb25zdCBzZW5zb3JWYWx1ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHNlbnNvclZhbHVlLmlubmVySFRNTCA9ICdObyBzZW5zb3IgZGF0YSc7XHJcbiAgICAgICAgc2Vuc29yVmFsdWUuaWQgPSBzZW5zb3JJZChzZW5zb3IuZGVzY3IpO1xyXG4gICAgICAgIGFydGljbGUuYXBwZW5kQ2hpbGQoc2Vuc29yVmFsdWUpO1xyXG5cclxuICAgICAgICBjb25zdCBzZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcCcpO1xyXG4gICAgICAgIHNlY3Rpb24uYXBwZW5kQ2hpbGQoYXJ0aWNsZSk7XHJcbiAgICB9XHJcbiAgICBsb2coc2Vuc29ycyk7XHJcbn1cclxubGV0IGlzTW9uaXRvcmluZyA9IGZhbHNlO1xyXG5mdW5jdGlvbiBzZXRNb25pdG9yaW5nQnV0dG9uKCkge1xyXG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vbml0b3InKTtcclxuICAgIGlmIChpc01vbml0b3JpbmcpIHtcclxuICAgICAgICBidXR0b24uaW5uZXJIVE1MID0gJ1N0b3AnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBidXR0b24uaW5uZXJIVE1MID0gJ01vbml0b3InO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzdGFydE1vbml0b3Ioc2Vuc29ycykge1xyXG4gICAgY29uc3QgZGVzY3IgPSAnc3RhcnRNb25pdG9yJztcclxuICAgIGNvbnN0IGRhdGE6IGFueSA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBzZW5zb3Igb2Ygc2Vuc29ycykge1xyXG4gICAgICAgIGRhdGEucHVzaChzZW5zb3IuZGVzY3IpO1xyXG4gICAgfVxyXG4gICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoe2Rlc2NyLCBkYXRhfSkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzdG9wTW9uaXRvcihzZW5zb3JzKSB7XHJcbiAgICBpc01vbml0b3JpbmcgPSBmYWxzZTtcclxuICAgIHNldE1vbml0b3JpbmdCdXR0b24oKTtcclxuICAgIGNvbnN0IGRlc2NyID0gJ3N0b3BNb25pdG9yJztcclxuICAgIGNvbnN0IGRhdGE6IGFueSA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBzZW5zb3Igb2Ygc2Vuc29ycykge1xyXG4gICAgICAgIGRhdGEucHVzaChzZW5zb3IuZGVzY3IpO1xyXG4gICAgfVxyXG4gICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoe2Rlc2NyLCBkYXRhfSkpO1xyXG59XHJcbmxldCBsb2dUaW1lcjtcclxuZnVuY3Rpb24gbG9nKHNlbnNvckRhdGEpIHtcclxuICAgIGlzTW9uaXRvcmluZyA9IHRydWU7XHJcbiAgICBzZXRNb25pdG9yaW5nQnV0dG9uKCk7XHJcbiAgICBmb3IgKGNvbnN0IHNlbnNvciBvZiBzZW5zb3JEYXRhKSB7XHJcbiAgICAgICAgY29uc3QgbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2Vuc29ySWQoc2Vuc29yLmRlc2NyKSk7XHJcbiAgICAgICAgaWYgKGxvZykge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoc2Vuc29yLnNhbXBsZXNbMF0uZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc2Vuc29yLnNhbXBsZXNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgIGxvZy5pbm5lckhUTUwgPSB2YWx1ZSArICcgwrBDLCBmcm9tOiAnICtcclxuICAgICAgICAgICAgICAgIGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCkgKyAnLCAnICsgZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgY2xlYXJUaW1lb3V0KGxvZ1RpbWVyKTtcclxuICAgIGxvZ1RpbWVyID0gc2V0SW50ZXJ2YWwoY2xlYXJTZW5zb3JWYWx1ZSwgNTAwMCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldHRpbmdzKGFsbFNldHRpbmdzKSB7XHJcbiAgICAvLyBUT0RPXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldENvbm5lY3Rpb25TdGF0dXMoY29ubmVjdGVkOiBib29sZWFuKSB7XHJcbiAgICBpZiAoY29ubmVjdGVkKSB7XHJcbiAgICAgICAgY29uc3Qgc3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nvbm5lY3Rpb24nKTtcclxuICAgICAgICBzdGF0dXMuaW5uZXJIVE1MID0gJyAobGl2ZSknO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBzdGF0dXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29ubmVjdGlvbicpO1xyXG4gICAgICAgIHN0YXR1cy5pbm5lckhUTUwgPSAnIChEaXNjb25uZWN0ZWQpJztcclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgdXJsID0gJ3dzOi8vcHJlY2lzaW9uLnZhZGluZy5sYW4nO1xyXG5sZXQgc29ja2V0ID0gbmV3IFdlYlNvY2tldCh1cmwpO1xyXG5zb2NrZXQub25vcGVuID0gZnVuY3Rpb24oZSkge1xyXG4gICAgc2V0Q29ubmVjdGlvblN0YXR1cyh0cnVlKTtcclxuICAgIHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHtkZXNjcjogJ2dldFNlbnNvcnMnfSkpO1xyXG4gICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoe2Rlc2NyOiAnZ2V0U2V0dGluZ3MnfSkpO1xyXG59O1xyXG5cclxuc29ja2V0Lm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICBzZXRDb25uZWN0aW9uU3RhdHVzKHRydWUpO1xyXG4gICAgY29uc3QgbXNnID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcclxuICAgIHN3aXRjaChtc2cuZGVzY3IpIHtcclxuICAgICAgICBjYXNlICdzZW5zb3JzJzpcclxuICAgICAgICAgICAgbGlzdFNlbnNvcnMobXNnLmRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoIWlzTW9uaXRvcmluZykge1xyXG4gICAgICAgICAgICAgICAgc3RhcnRNb25pdG9yKHNlbnNvcnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3NldHRpbmdzJzpcclxuICAgICAgICAgICAgc2V0dGluZ3MobXNnLmRhdGEpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdsb2cnOlxyXG4gICAgICAgICAgICBsb2cobXNnLmRhdGEpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG59O1xyXG5cclxuc29ja2V0Lm9uY2xvc2UgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgc2V0Q29ubmVjdGlvblN0YXR1cyhmYWxzZSk7XHJcbiAgICBpZiAoZXZlbnQud2FzQ2xlYW4pIHtcclxuICAgICAgICBhbGVydChgW2Nsb3NlXSBDb25uZWN0aW9uIGNsb3NlZCBjbGVhbmx5LCBjb2RlPSR7ZXZlbnQuY29kZX0gcmVhc29uPSR7ZXZlbnQucmVhc29ufWApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBlLmcuIHNlcnZlciBwcm9jZXNzIGtpbGxlZCBvciBuZXR3b3JrIGRvd25cclxuICAgICAgICAvLyBldmVudC5jb2RlIGlzIHVzdWFsbHkgMTAwNiBpbiB0aGlzIGNhc2VcclxuICAgICAgICBhbGVydCgnW2Nsb3NlXSBDb25uZWN0aW9uIGRpZWQnKTtcclxuICAgIH1cclxufTtcclxuXHJcbnNvY2tldC5vbmVycm9yID0gZnVuY3Rpb24oZXJyb3IpIHtcclxuICAgIHNldENvbm5lY3Rpb25TdGF0dXMoZmFsc2UpO1xyXG4gICAgLy8gYWxlcnQoYFtlcnJvcl0gJHtlcnJvci5tZXNzYWdlfWApO1xyXG59O1xyXG5cclxuXHJcbmZ1bmN0aW9uIHNpbXVsYXRlTW9uaXRvcmluZyhzZW5zb3JzKSB7XHJcbiAgICBmb3IgKGNvbnN0IHNlbnNvciBvZiBzZW5zb3JzKSB7XHJcbiAgICAgICAgLy8gc2ltdWxhdGUgdGltZXN0YW1wXHJcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxNTAwMCkpO1xyXG4gICAgICAgIHNlbnNvci5zYW1wbGVzWzBdLmRhdGUgPSBkYXRlLmdldE1pbGxpc2Vjb25kcygpO1xyXG5cclxuICAgICAgICAvLyBzaW11bGF0ZSBuZXcgc2Vuc29yIHJlYWRpbmdcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHNlbnNvci5zYW1wbGVzWzBdLnZhbHVlICsgNSAqIE1hdGgucmFuZG9tKCk7XHJcbiAgICAgICAgc2Vuc29yLnNhbXBsZXNbMF0udmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIG1vbml0b3IoKSB7XHJcbiAgICBpZiAoaXNNb25pdG9yaW5nKSB7XHJcbiAgICAgICAgc3RvcE1vbml0b3Ioc2Vuc29ycyk7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBzdGFydE1vbml0b3Ioc2Vuc29ycyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFyU2Vuc29yVmFsdWUoKSB7XHJcbiAgICBmb3IgKGNvbnN0IHNlbnNvciBvZiBzZW5zb3JzKSB7XHJcbiAgICAgICAgY29uc3Qgc2FtcGxlRGF0ZSA9IHNlbnNvci5zYW1wbGVzWzBdLmRhdGU7XHJcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSBzYW1wbGVEYXRlID4gNyoyNCozNjAwXzAwMCkge1xyXG4gICAgICAgICAgICBjb25zdCBzZW5zb3JWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbnNvcklkKHNlbnNvcikpO1xyXG4gICAgICAgICAgICBzZW5zb3JWYWx1ZS5pbm5lckhUTUwgPSAnTm8gc2Vuc29yIGRhdGEgcmVjZWl2ZWQgbGFzdCAxNSBzZWNvbmRzJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q29ubmVjdGlvblN0YXR1cyhzb2NrZXQucmVhZHlTdGF0ZSA9PT0gc29ja2V0Lk9QRU4pO1xyXG4gICAgaWYgKHNvY2tldC5yZWFkeVN0YXRlID09PSBzb2NrZXQuQ0xPU0VEKSB7XHJcbiAgICAgICAgc29ja2V0ID0gbmV3IFdlYlNvY2tldCh1cmwpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiByb3VuZCh2YWx1ZSwgcHJlY2lzaW9uKSB7XHJcbiAgICAvLyAgICBwcmVjaXNpb24gfHwgKHByZWNpc2lvbiA9IDEpO1xyXG4gICAgY29uc3QgaW52ZXJzZSA9IDEuMCAvIHByZWNpc2lvbjtcclxuICAgIHJldHVybiBNYXRoLnJvdW5kKHZhbHVlICogaW52ZXJzZSkgLyBpbnZlcnNlO1xyXG59XHJcbiJdfQ==
