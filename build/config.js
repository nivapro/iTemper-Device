"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
var fs = __importStar(require("fs"));
var os = __importStar(require("os"));
var path = __importStar(require("path"));
var Config = (function () {
    function Config() {
        this.sharedKeyFileName = '.key';
        this.reset();
        this.readSharedKey();
    }
    Config.prototype.reset = function () {
        Config.env = {
            _SERIAL_NUMBER: process.env.SERIAL_NUMBER || os.hostname(),
            _ITEMPER_URL: process.env.ITEMPER_URL,
            _WS_URL: process.env.WS_URL,
            _WS_ORIGIN: process.env.WS_ORIGIN,
            _AZURE_CONNECTION_STRING: process.env.AZURE_CONNECTION_STRING,
            _POLL_INTERVAL: process.env.POLL_INTERVAL,
            _ERROR_LOG_FILE: process.env.ERROR_LOG_FILE,
            _ERROR_LEVEL: process.env.ERROR_LEVEL,
            _CONSOLE_LEVEL: process.env.CONSOLE_LEVEL,
            _HOSTNAME: os.hostname(),
            _SHARED_ACCESS_KEY: process.env.SHARED_ACCESS_KEY,
        };
    };
    Object.defineProperty(Config.prototype, "SERIAL_NUMBER", {
        get: function () { return Config.env._SERIAL_NUMBER || ''; },
        set: function (value) { Config.env._SERIAL_NUMBER = value; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "ITEMPER_URL", {
        get: function () { return Config.env._ITEMPER_URL || ''; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "WS_URL", {
        get: function () { return Config.env._WS_URL || ''; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "WS_ORIGIN", {
        get: function () { return Config.env._WS_ORIGIN || ''; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "AZURE_CONNECTION_STRING", {
        get: function () { return Config.env._AZURE_CONNECTION_STRING || ''; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "POLL_INTERVAL", {
        get: function () {
            if (!Config.env._POLL_INTERVAL) {
                return 60000;
            }
            else {
                return +Config.env._POLL_INTERVAL;
            }
        },
        set: function (value) { Config.env._POLL_INTERVAL = value.toString(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "ERROR_LOG_FILE", {
        get: function () { return Config.env._ERROR_LOG_FILE; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "ERROR_LEVEL", {
        get: function () { return Config.env._ERROR_LEVEL; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "CONSOLE_LEVEL", {
        get: function () { return Config.env._CONSOLE_LEVEL; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "HOSTNAME", {
        get: function () { return Config.env._HOSTNAME; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Config.prototype, "SHARED_ACCESS_KEY", {
        get: function () { this.readSharedKey(); return Config.env._SHARED_ACCESS_KEY || ''; },
        set: function (value) { Config.env._SHARED_ACCESS_KEY = value; this.saveSharedKey(); },
        enumerable: true,
        configurable: true
    });
    Config.prototype.readSharedKey = function () {
        var defaultKey = process.env.SHARED_ACCESS_KEY;
        fs.readFile(path.join(__dirname, this.sharedKeyFileName), 'utf8', function (err, data) {
            if (err) {
                Config.env._SHARED_ACCESS_KEY = defaultKey;
            }
            else {
                try {
                    Config.env._SHARED_ACCESS_KEY = JSON.parse(data).SHARED_ACCESS_KEY;
                }
                catch (e) {
                    Config.env._SHARED_ACCESS_KEY = defaultKey;
                }
            }
        });
    };
    Config.prototype.saveSharedKey = function () {
        fs.writeFile(path.join(__dirname, this.sharedKeyFileName), { SHARED_ACCESS_KEY: Config.env._SHARED_ACCESS_KEY }, 'utf8', function (err) {
            if (err) {
                throw Error();
            }
        });
    };
    return Config;
}());
exports.conf = new Config();

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLEVBQUUsTUFBTSxFQUM1RCxVQUFDLEdBQUc7WUFDQSxJQUFJLEdBQUcsRUFBRTtnQkFDTCxNQUFNLEtBQUssRUFBRSxDQUFDO2FBQ2pCO1FBQ2IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsYUFBQztBQUFELENBbEZBLEFBa0ZDLElBQUE7QUFFWSxRQUFBLElBQUksR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDIiwiZmlsZSI6ImNvbmZpZy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcclxuaW1wb3J0ICogYXMgb3MgZnJvbSAnb3MnO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuaW50ZXJmYWNlIE9wdGlvbnMge1xyXG4gICAgX1NFUklBTF9OVU1CRVI/OiBzdHJpbmc7XHJcbiAgICBfSVRFTVBFUl9VUkw/OiBzdHJpbmc7XHJcbiAgICBfV1NfVVJMPzogc3RyaW5nO1xyXG4gICAgX1dTX09SSUdJTj86IHN0cmluZztcclxuICAgIF9BWlVSRV9DT05ORUNUSU9OX1NUUklORz86IHN0cmluZztcclxuICAgIF9QT0xMX0lOVEVSVkFMPzogc3RyaW5nO1xyXG4gICAgX0VSUk9SX0xPR19GSUxFPzogc3RyaW5nO1xyXG4gICAgX0VSUk9SX0xFVkVMPzogc3RyaW5nO1xyXG4gICAgX0NPTlNPTEVfTEVWRUw/OiBzdHJpbmc7XHJcbiAgICBfSE9TVE5BTUU/OiBzdHJpbmc7XHJcbiAgICBfU0hBUkVEX0FDQ0VTU19LRVk/OiBzdHJpbmc7XHJcbn1cclxuY2xhc3MgQ29uZmlnIHtcclxuICAgIHByaXZhdGUgc3RhdGljIGVudjogT3B0aW9ucztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy5yZWFkU2hhcmVkS2V5KCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHJlc2V0KCkge1xyXG4gICAgICAgIENvbmZpZy5lbnYgPSB7XHJcbiAgICAgICAgICAgIF9TRVJJQUxfTlVNQkVSOiBwcm9jZXNzLmVudi5TRVJJQUxfTlVNQkVSIHx8IG9zLmhvc3RuYW1lKCksXHJcbiAgICAgICAgICAgIF9JVEVNUEVSX1VSTCA6IHByb2Nlc3MuZW52LklURU1QRVJfVVJMLFxyXG4gICAgICAgICAgICBfV1NfVVJMIDogcHJvY2Vzcy5lbnYuV1NfVVJMLFxyXG4gICAgICAgICAgICBfV1NfT1JJR0lOIDogcHJvY2Vzcy5lbnYuV1NfT1JJR0lOLFxyXG4gICAgICAgICAgICBfQVpVUkVfQ09OTkVDVElPTl9TVFJJTkcgOiBwcm9jZXNzLmVudi5BWlVSRV9DT05ORUNUSU9OX1NUUklORyxcclxuICAgICAgICAgICAgX1BPTExfSU5URVJWQUwgOiBwcm9jZXNzLmVudi5QT0xMX0lOVEVSVkFMLFxyXG4gICAgICAgICAgICBfRVJST1JfTE9HX0ZJTEUgOiBwcm9jZXNzLmVudi5FUlJPUl9MT0dfRklMRSxcclxuICAgICAgICAgICAgX0VSUk9SX0xFVkVMIDogcHJvY2Vzcy5lbnYuRVJST1JfTEVWRUwsXHJcbiAgICAgICAgICAgIF9DT05TT0xFX0xFVkVMIDogcHJvY2Vzcy5lbnYuQ09OU09MRV9MRVZFTCxcclxuICAgICAgICAgICAgX0hPU1ROQU1FIDogb3MuaG9zdG5hbWUoKSxcclxuICAgICAgICAgICAgX1NIQVJFRF9BQ0NFU1NfS0VZOiBwcm9jZXNzLmVudi5TSEFSRURfQUNDRVNTX0tFWSxcclxuICAgICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuZ2V0IFNFUklBTF9OVU1CRVIoKSB7IHJldHVybiBDb25maWcuZW52Ll9TRVJJQUxfTlVNQkVSIHx8ICcnO31cclxuXHJcbnNldCBTRVJJQUxfTlVNQkVSKHZhbHVlOiBzdHJpbmcpIHsgQ29uZmlnLmVudi5fU0VSSUFMX05VTUJFUj12YWx1ZTsgfVxyXG5cclxuZ2V0IElURU1QRVJfVVJMKCk6IHN0cmluZyB7IHJldHVybiBDb25maWcuZW52Ll9JVEVNUEVSX1VSTCB8fCAnJzt9XHJcblxyXG5nZXQgV1NfVVJMKCk6IHN0cmluZyB7IHJldHVybiBDb25maWcuZW52Ll9XU19VUkwgfHwgJyc7IH1cclxuXHJcbmdldCBXU19PUklHSU4oKTogc3RyaW5nIHtyZXR1cm4gQ29uZmlnLmVudi5fV1NfT1JJR0lOIHx8ICcnO31cclxuXHJcbmdldCBBWlVSRV9DT05ORUNUSU9OX1NUUklORygpOiBzdHJpbmcge3JldHVybiBDb25maWcuZW52Ll9BWlVSRV9DT05ORUNUSU9OX1NUUklORyB8fCAnJzt9XHJcblxyXG5nZXQgUE9MTF9JTlRFUlZBTCgpOiBudW1iZXIge1xyXG4gICAgaWYgKCFDb25maWcuZW52Ll9QT0xMX0lOVEVSVkFMKSB7XHJcbiAgICAgICAgcmV0dXJuIDYwMDAwO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gK0NvbmZpZy5lbnYuX1BPTExfSU5URVJWQUw7XHJcbiAgICB9XHJcbn1cclxuc2V0IFBPTExfSU5URVJWQUwodmFsdWU6IG51bWJlcikge0NvbmZpZy5lbnYuX1BPTExfSU5URVJWQUwgPSB2YWx1ZS50b1N0cmluZygpO31cclxuXHJcbmdldCBFUlJPUl9MT0dfRklMRSgpIHtyZXR1cm4gQ29uZmlnLmVudi5fRVJST1JfTE9HX0ZJTEU7fVxyXG5cclxuZ2V0IEVSUk9SX0xFVkVMKCkge3JldHVybiBDb25maWcuZW52Ll9FUlJPUl9MRVZFTDt9XHJcblxyXG5nZXQgQ09OU09MRV9MRVZFTCgpIHtyZXR1cm4gQ29uZmlnLmVudi5fQ09OU09MRV9MRVZFTDt9XHJcblxyXG5nZXQgSE9TVE5BTUUoKSB7cmV0dXJuIENvbmZpZy5lbnYuX0hPU1ROQU1FO31cclxuXHJcbmdldCBTSEFSRURfQUNDRVNTX0tFWSgpIHsgdGhpcy5yZWFkU2hhcmVkS2V5KCkgO3JldHVybiBDb25maWcuZW52Ll9TSEFSRURfQUNDRVNTX0tFWSB8fCAnJzt9XHJcblxyXG5zZXQgU0hBUkVEX0FDQ0VTU19LRVkodmFsdWU6IHN0cmluZykgeyBDb25maWcuZW52Ll9TSEFSRURfQUNDRVNTX0tFWT12YWx1ZTt0aGlzLnNhdmVTaGFyZWRLZXkoKTsgfVxyXG5cclxucHJpdmF0ZSBzaGFyZWRLZXlGaWxlTmFtZSA9ICcua2V5JztcclxucHJpdmF0ZSByZWFkU2hhcmVkS2V5KCk6IHZvaWQge1xyXG4gICAgY29uc3QgZGVmYXVsdEtleSA9IHByb2Nlc3MuZW52LlNIQVJFRF9BQ0NFU1NfS0VZO1xyXG5cclxuICAgIGZzLnJlYWRGaWxlKHBhdGguam9pbihfX2Rpcm5hbWUsIHRoaXMuc2hhcmVkS2V5RmlsZU5hbWUpLCAndXRmOCcsIChlcnIsIGRhdGEpPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgQ29uZmlnLmVudi5fU0hBUkVEX0FDQ0VTU19LRVkgPSBkZWZhdWx0S2V5O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBDb25maWcuZW52Ll9TSEFSRURfQUNDRVNTX0tFWSA9ICBKU09OLnBhcnNlKGRhdGEpLlNIQVJFRF9BQ0NFU1NfS0VZO1xyXG4gICAgICAgICAgICB9IGNhdGNoKGUpIHtcclxuICAgICAgICAgICAgICAgIENvbmZpZy5lbnYuX1NIQVJFRF9BQ0NFU1NfS0VZPSBkZWZhdWx0S2V5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxucHJpdmF0ZSBzYXZlU2hhcmVkS2V5KCk6IHZvaWQge1xyXG4gICAgZnMud3JpdGVGaWxlKHBhdGguam9pbihfX2Rpcm5hbWUsIHRoaXMuc2hhcmVkS2V5RmlsZU5hbWUpLFxyXG4gICAgICAgICAgICB7IFNIQVJFRF9BQ0NFU1NfS0VZOiBDb25maWcuZW52Ll9TSEFSRURfQUNDRVNTX0tFWSB9LCAndXRmOCcsXHJcbiAgICAgICAgICAgIChlcnIpPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmYgPSBuZXcgQ29uZmlnKCk7XHJcblxyXG4iXX0=
